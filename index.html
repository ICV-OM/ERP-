<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹ | PMS</title>
<link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700;800;900&display=swap" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.1/chart.umd.min.js"></script>
<style>
:root{--p:#0C4A6E;--p2:#0284C7;--ac:#F59E0B;--ok:#059669;--er:#DC2626;--bg:#F1F5F9;--card:#fff;--tx:#1E293B;--tx2:#64748B;--tx3:#94A3B8;--bd:#E2E8F0;--bd2:#F1F5F9;--r:13px;--rs:9px}
*{box-sizing:border-box;margin:0;padding:0}
body{font-family:'Tajawal',sans-serif;background:var(--bg);color:var(--tx)}
::-webkit-scrollbar{width:5px}::-webkit-scrollbar-thumb{background:#CBD5E1;border-radius:3px}
input,select,textarea,button{font-family:'Tajawal',sans-serif;outline:none}
@keyframes spin{to{transform:rotate(360deg)}}
@keyframes fadeIn{from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:none}}

/* LOADING */
.ld-ov{position:fixed;inset:0;background:rgba(255,255,255,.85);z-index:9999;display:none;align-items:center;justify-content:center;flex-direction:column;gap:12px}
.ld-ov.on{display:flex}
.ld-sp{width:36px;height:36px;border:3px solid #E2E8F0;border-top-color:var(--p2);border-radius:50%;animation:spin .7s linear infinite}

/* LOGIN */
.login{min-height:100vh;display:flex;background:linear-gradient(135deg,#0C4A6E,#0369A1 40%,#0284C7 70%,#0EA5E9);position:relative;overflow:hidden}
.login .bg-c{position:absolute;border-radius:50%;pointer-events:none}
.bg1{top:8%;right:3%;width:380px;height:380px;background:rgba(255,255,255,.03);border:1px solid rgba(255,255,255,.06)}
.bg2{bottom:10%;left:8%;width:280px;height:280px;background:rgba(255,255,255,.04)}
.bg3{top:45%;right:35%;width:180px;height:180px;background:rgba(245,158,11,.08)}
.l-left{flex:1;display:flex;flex-direction:column;justify-content:center;align-items:center;padding:40px;z-index:1;text-align:center}
.l-icon{width:76px;height:76px;border-radius:20px;background:rgba(255,255,255,.14);backdrop-filter:blur(16px);display:flex;align-items:center;justify-content:center;margin:0 auto 22px;border:1px solid rgba(255,255,255,.18)}
.l-left h1{font-size:32px;font-weight:900;color:#fff}
.l-left p{font-size:15px;color:rgba(255,255,255,.7);margin-top:10px;line-height:1.8}
.l-right{width:470px;display:flex;align-items:center;justify-content:center;padding:30px;z-index:1}
.l-card{width:100%;max-width:390px;background:rgba(255,255,255,.96);backdrop-filter:blur(30px);border-radius:22px;padding:36px 32px;box-shadow:0 20px 60px rgba(0,0,0,.18)}
.l-card h2{font-size:21px;font-weight:800;color:#0F172A;text-align:center;margin-bottom:4px}
.l-card .sub{font-size:12px;color:var(--tx2);text-align:center;margin-bottom:24px}
.fg{margin-bottom:16px}
.fg label{display:block;font-size:11px;font-weight:600;color:#374151;margin-bottom:5px}
.fg input,.fg select{width:100%;padding:11px 14px;border-radius:11px;border:2px solid var(--bd);font-size:13px;background:#F8FAFC;transition:.2s;color:var(--tx)}
.fg input:focus,.fg select:focus{border-color:var(--p2);background:#fff}
.l-err{background:#FEE2E2;color:var(--er);padding:10px;border-radius:10px;font-size:12px;text-align:center;margin-bottom:12px;display:none}
.l-err.on{display:block}
.btn-auth{width:100%;padding:13px;border-radius:12px;border:none;font-size:15px;font-weight:700;background:linear-gradient(135deg,var(--p),var(--p2));color:#fff;cursor:pointer;transition:.2s;box-shadow:0 4px 14px rgba(12,74,110,.3);margin-top:6px}
.btn-auth:hover{transform:translateY(-1px);box-shadow:0 5px 18px rgba(12,74,110,.4)}
.l-hint{text-align:center;margin-top:16px;font-size:11px;color:var(--tx2);background:#EFF6FF;padding:10px;border-radius:10px}
.l-hint b{color:var(--p2);cursor:pointer}
.l-foot{text-align:center;margin-top:14px;font-size:10px;color:#94A3B8}
.hide{display:none!important}
.spinner-s{display:inline-block;width:16px;height:16px;border:2px solid rgba(255,255,255,.3);border-top-color:#fff;border-radius:50%;animation:spin .7s linear infinite;vertical-align:middle;margin-left:6px}

/* APP */
.app{display:none;min-height:100vh}
.app.on{display:block}

/* SIDEBAR */
.sb{width:240px;min-height:100vh;background:linear-gradient(180deg,#0C4A6E,#082F49);position:fixed;right:0;top:0;z-index:100;display:flex;flex-direction:column;transition:.25s}
.sb.mini{width:68px}
.sb-hd{padding:18px 16px;border-bottom:1px solid rgba(255,255,255,.07);display:flex;align-items:center;gap:10px}
.sb.mini .sb-hd{justify-content:center;padding:18px 8px}
.sb-lg{width:36px;height:36px;border-radius:10px;background:rgba(245,158,11,.2);display:flex;align-items:center;justify-content:center;flex-shrink:0}
.sb-nm{font-size:14px;font-weight:800;color:#fff;white-space:nowrap}
.sb-v{font-size:9px;color:rgba(255,255,255,.4)}
.sb.mini .sb-tx{display:none}
.sb-sec{font-size:10px;color:rgba(255,255,255,.3);text-transform:uppercase;letter-spacing:1px;padding:14px 13px 6px;font-weight:700}
.sb.mini .sb-sec{display:none}
.sb-nav{flex:1;padding:8px 8px;display:flex;flex-direction:column;gap:1px;overflow-y:auto}
.nv{display:flex;align-items:center;gap:11px;padding:11px 13px;border-radius:11px;border:none;cursor:pointer;background:transparent;width:100%;transition:.15s;color:rgba(255,255,255,.5);font-size:13px;font-weight:500;font-family:'Tajawal',sans-serif}
.sb.mini .nv{justify-content:center;padding:11px 0}
.nv:hover{background:rgba(255,255,255,.07);color:rgba(255,255,255,.8)}
.nv.on{background:rgba(245,158,11,.14);color:#F59E0B;font-weight:700}
.sb.mini .nv span{display:none}
.nv-ic{font-size:18px;width:22px;text-align:center;flex-shrink:0}
.sb-ft{padding:12px;border-top:1px solid rgba(255,255,255,.07);display:flex;align-items:center;gap:10px}
.sb-av{width:36px;height:36px;border-radius:10px;background:linear-gradient(135deg,#059669,#0EA5E9);display:flex;align-items:center;justify-content:center;font-weight:700;font-size:14px;color:#fff;flex-shrink:0}
.sb.mini .sb-un,.sb.mini .sb-lo{display:none}
.sb-un .nm{font-size:12px;font-weight:700;color:#fff}.sb-un .rl{font-size:10px;color:rgba(255,255,255,.4)}
.sb-lo{margin-right:auto;width:32px;height:32px;border-radius:8px;border:none;background:rgba(255,255,255,.05);cursor:pointer;color:rgba(255,255,255,.4);display:flex;align-items:center;justify-content:center;font-size:16px}
.sb-lo:hover{background:rgba(220,38,38,.15);color:#DC2626}
.sb-tog{width:100%;padding:8px;border-radius:8px;border:none;background:rgba(255,255,255,.05);cursor:pointer;color:rgba(255,255,255,.35);display:flex;align-items:center;justify-content:center;margin-bottom:8px}

/* MAIN */
.main{margin-right:240px;transition:.25s;min-height:100vh}
.main.mini{margin-right:68px}
.hdr{height:60px;background:#fff;border-bottom:1px solid var(--bd);display:flex;align-items:center;justify-content:space-between;padding:0 22px;position:sticky;top:0;z-index:50}
.hdr h1{font-size:19px;font-weight:800;color:var(--tx)}
.h-r{display:flex;align-items:center;gap:12px}
.h-u{display:flex;align-items:center;gap:9px;padding-right:12px;border-right:1px solid var(--bd)}
.h-av{width:36px;height:36px;border-radius:10px;background:linear-gradient(135deg,var(--p),var(--p2));display:flex;align-items:center;justify-content:center;color:#fff;font-size:14px;font-weight:700}
.h-nm{font-size:12px;font-weight:700}.h-rl{font-size:10px;color:#94A3B8}
.h-lo{width:36px;height:36px;border-radius:10px;border:1px solid #FEE2E2;background:#FEF2F2;display:flex;align-items:center;justify-content:center;cursor:pointer;font-size:14px;border:none}
.h-menu{display:none;width:36px;height:36px;border-radius:8px;border:1px solid var(--bd);background:#fff;color:var(--tx2);align-items:center;justify-content:center;cursor:pointer;font-size:16px}
.pg{padding:22px;animation:fadeIn .3s ease}

/* CARDS & STATS */
.g4{display:grid;grid-template-columns:repeat(4,1fr);gap:14px;margin-bottom:18px}
.g3{display:grid;grid-template-columns:repeat(3,1fr);gap:14px;margin-bottom:18px}
.g2{display:grid;grid-template-columns:1fr 1fr;gap:14px;margin-bottom:18px}
.st{background:var(--card);border-radius:var(--r);padding:18px 16px;border:1px solid var(--bd);transition:.2s}
.st:hover{box-shadow:0 3px 12px rgba(0,0,0,.04)}
.st-i{width:42px;height:42px;border-radius:11px;display:flex;align-items:center;justify-content:center;margin-bottom:12px;font-size:18px}
.st-v{font-size:24px;font-weight:800;color:#0F172A}
.st-l{font-size:11px;color:var(--tx2);margin-top:2px}
.card{background:var(--card);border-radius:var(--r);padding:18px;border:1px solid var(--bd);margin-bottom:16px;animation:fadeIn .3s ease}
.card-h{display:flex;justify-content:space-between;align-items:center;margin-bottom:14px}
.card-t{font-size:14px;font-weight:700;color:#0F172A;display:flex;align-items:center;gap:8px}

/* PROGRESS */
.prg{display:flex;align-items:center;gap:7px}.prg-t{flex:1;height:6px;background:#E2E8F0;border-radius:6px;overflow:hidden}
.prg-f{height:100%;border-radius:6px;transition:width .8s}.prg-v{font-size:10px;font-weight:700;min-width:28px;text-align:left}

/* BADGES */
.bg-s{display:inline-flex;align-items:center;gap:4px;padding:3px 9px;border-radius:14px;font-size:10px;font-weight:600}
.bg-d{width:5px;height:5px;border-radius:50%}
.bg-act{background:#DBEAFE;color:#1D4ED8}.bg-act .bg-d{background:#3B82F6}
.bg-ok{background:#D1FAE5;color:#047857}.bg-ok .bg-d{background:#10B981}
.bg-er{background:#FEE2E2;color:#B91C1C}.bg-er .bg-d{background:#EF4444}
.bg-nw{background:#FEF3C7;color:#92400E}.bg-nw .bg-d{background:#F59E0B}
.bg-pr{background:#EDE9FE;color:#6D28D9}.bg-pr .bg-d{background:#8B5CF6}
.bg-gy{background:#F1F5F9;color:#64748B}.bg-gy .bg-d{background:#94A3B8}
.pr-h{background:#FEE2E2;color:var(--er);padding:2px 7px;border-radius:4px;font-size:9px;font-weight:600}
.pr-m{background:#FEF3C7;color:#D97706;padding:2px 7px;border-radius:4px;font-size:9px;font-weight:600}
.pr-l{background:#D1FAE5;color:var(--ok);padding:2px 7px;border-radius:4px;font-size:9px;font-weight:600}

/* TABLE */
table.tb{width:100%;border-collapse:collapse}
.tb th{padding:10px 12px;font-size:10px;font-weight:700;color:var(--tx2);text-align:right;background:#F8FAFC;border-bottom:1px solid var(--bd)}
.tb td{padding:12px;font-size:11px;border-bottom:1px solid var(--bd2);vertical-align:middle}
.tb tr:hover td{background:#FAFBFC}

/* BUTTONS */
.btn{display:inline-flex;align-items:center;gap:6px;padding:8px 16px;border-radius:9px;border:none;font-size:12px;font-weight:700;cursor:pointer;transition:.15s;font-family:'Tajawal',sans-serif}
.btn-p{background:linear-gradient(135deg,var(--p),var(--p2));color:#fff;box-shadow:0 3px 10px rgba(12,74,110,.2)}
.btn-p:hover{transform:translateY(-1px)}
.btn-ai{background:linear-gradient(135deg,#4f46e5,#7c3aed);color:#fff;box-shadow:0 3px 10px rgba(124,58,237,.2);position:relative;overflow:hidden}
.btn-ai::before{content:'';position:absolute;inset:0;background:linear-gradient(135deg,transparent 30%,rgba(255,255,255,.1) 50%,transparent 70%);transform:translateX(-100%);animation:shm 3s infinite}
@keyframes shm{0%{transform:translateX(-100%)}100%{transform:translateX(100%)}}
.btn-d{background:none;border:1px solid #FEE2E2;color:var(--er);padding:5px 9px;border-radius:7px;font-size:10px;cursor:pointer}
.btn-d:hover{background:#FEF2F2}
.btn-e{background:none;border:1px solid #FEF3C7;color:#D97706;padding:5px 9px;border-radius:7px;font-size:10px;cursor:pointer}
.btn-e:hover{background:#FFFBEB}
.emp-box{text-align:center;padding:44px 18px}

/* MODAL */
.mo{position:fixed;inset:0;background:rgba(0,0,0,.45);z-index:500;display:none;align-items:center;justify-content:center}
.mo.on{display:flex}
.mo-c{background:#fff;border-radius:16px;padding:26px;width:500px;max-width:92vw;max-height:85vh;overflow-y:auto;animation:fadeIn .2s}
.mo-c.wide{width:700px}
.mo-c h3{font-size:16px;font-weight:700;margin-bottom:18px;display:flex;align-items:center;justify-content:space-between}
.mo-c h3 button{width:28px;height:28px;border-radius:7px;border:1px solid var(--bd);background:#fff;cursor:pointer;font-size:14px;color:var(--tx2);display:flex;align-items:center;justify-content:center}
.m2{display:grid;grid-template-columns:1fr 1fr;gap:8px}
.m3{display:grid;grid-template-columns:1fr 1fr 1fr;gap:8px}
.fg-s{width:100%;padding:10px 12px;border-radius:9px;border:1px solid var(--bd);font-size:12px;background:#F8FAFC;transition:.2s;font-family:'Tajawal',sans-serif;color:var(--tx)}
.fg-s:focus{border-color:var(--p2);background:#fff}
select.fg-s{appearance:none;cursor:pointer}
.btn-sub{width:100%;padding:11px;border-radius:10px;border:none;font-size:14px;font-weight:700;background:linear-gradient(135deg,var(--p),var(--p2));color:#fff;cursor:pointer;margin-top:12px;transition:.2s}
.btn-sub:hover{transform:translateY(-1px)}

/* FILTER BAR */
.fb{display:flex;gap:10px;flex-wrap:wrap;margin-bottom:14px;align-items:center}
.fb-s{flex:1;min-width:180px;position:relative}
.fb-s input{width:100%;padding:9px 12px 9px 32px;border-radius:var(--rs);border:1px solid var(--bd);font-size:12px;background:#F8FAFC;color:var(--tx)}
.fb-s input:focus{border-color:var(--p2);background:#fff}
.fb-s .ic{position:absolute;left:10px;top:50%;transform:translateY(-50%);color:var(--tx3);pointer-events:none;font-size:14px}
.fb select{min-width:140px;padding:9px 12px;border-radius:var(--rs);border:1px solid var(--bd);font-size:12px;background:#F8FAFC;appearance:none;cursor:pointer;color:var(--tx)}
.qf{display:inline-flex;padding:6px 14px;border-radius:7px;border:1px solid var(--bd);background:#fff;color:var(--tx2);font-size:11px;font-weight:600;cursor:pointer;transition:.15s}
.qf:hover{border-color:var(--p2);color:var(--p2)}.qf.on{border-color:var(--p2);color:var(--p2);background:#EFF6FF}

/* FINANCE */
.gauge-wrap{display:flex;flex-direction:column;align-items:center;padding:16px}
.gauge-ct{position:relative;width:200px;height:200px}
.gauge-center{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);text-align:center}
.gauge-pct{font-size:32px;font-weight:900;color:var(--p2)}.gauge-lbl{font-size:11px;color:var(--tx3)}
.fin-stat{display:flex;align-items:center;justify-content:space-between;padding:16px;background:#F8FAFC;border:1px solid var(--bd);border-radius:12px;margin-bottom:10px}
.fin-dot{width:12px;height:12px;border-radius:50%}.fin-lbl{font-size:13px;color:var(--tx2)}
.fin-val{font-size:20px;font-weight:800}

/* HR DEPARTMENTS */
.dept-card{background:var(--card);border:1px solid var(--bd);border-radius:var(--r);overflow:hidden;margin-bottom:12px}
.dept-hd{padding:16px 18px;display:flex;align-items:center;gap:14px;cursor:pointer}.dept-hd:hover{background:#F8FAFC}
.dept-ic{width:42px;height:42px;border-radius:11px;background:#EFF6FF;display:flex;align-items:center;justify-content:center;font-size:20px}
.dept-nm{font-size:15px;font-weight:700}.dept-cnt{font-size:12px;color:var(--tx3)}
.dept-tgl{margin-right:auto;font-size:16px;color:var(--tx3);transition:transform .3s}
.dept-card.open .dept-tgl{transform:rotate(180deg)}
.dept-bd{display:none;border-top:1px solid var(--bd)}.dept-card.open .dept-bd{display:block}
.emp-row{display:flex;align-items:center;gap:14px;padding:14px 18px;border-bottom:1px solid var(--bd2)}.emp-row:last-child{border-bottom:none}
.emp-av{width:38px;height:38px;border-radius:10px;background:#EFF6FF;display:flex;align-items:center;justify-content:center;font-size:16px;color:var(--p2)}
.emp-info{flex:1}.emp-nm{font-weight:700;font-size:14px}.emp-rl{font-size:11px;color:var(--tx3)}

/* EVAL STARS */
.stars{display:inline-flex;direction:ltr;gap:1px}.star{font-size:16px;color:#CBD5E1}.star.on{color:#FBBF24}

/* BOARD */
.board-cols{display:grid;grid-template-columns:repeat(auto-fit,minmax(230px,1fr));gap:14px}
.board-col{background:var(--card);border:1px solid var(--bd);border-radius:var(--r);overflow:hidden}
.board-col-hd{padding:12px;border-bottom:1px solid var(--bd);font-weight:700;font-size:13px;display:flex;justify-content:space-between;background:#F8FAFC}
.board-col-hd .cnt{background:#E2E8F0;padding:2px 8px;border-radius:5px;font-size:11px;color:var(--tx3)}
.board-col-bd{padding:8px;min-height:80px;display:flex;flex-direction:column;gap:6px}
.b-card{background:#F8FAFC;border:1px solid var(--bd);border-radius:var(--rs);padding:12px;transition:.2s}.b-card:hover{border-color:var(--p2)}
.b-card-t{font-weight:700;font-size:13px;margin-bottom:4px}.b-card-m{display:flex;justify-content:space-between;font-size:10px;color:var(--tx3)}

/* AI */
.ai-card{background:#F8FAFC;border:1px solid var(--bd);border-radius:var(--rs);padding:16px;margin-bottom:10px}
.ai-card h4{font-size:13px;font-weight:700;margin-bottom:6px;color:var(--p2)}.ai-card p{font-size:12px;line-height:1.8;color:var(--tx2)}
.spinner{width:36px;height:36px;border:3px solid var(--bd);border-top-color:var(--p2);border-radius:50%;animation:spin .8s linear infinite;margin:0 auto 14px}

/* TOAST */
.toast{position:fixed;bottom:24px;left:50%;transform:translateX(-50%);background:var(--ok);color:#fff;padding:12px 28px;border-radius:10px;font-size:13px;font-weight:700;z-index:999;box-shadow:0 4px 20px rgba(5,150,105,.3);animation:fadeIn .3s}

/* CALENDAR */
.cg{display:grid;grid-template-columns:repeat(7,1fr);gap:2px}
.c-hd{padding:8px;text-align:center;font-size:10px;font-weight:700;color:var(--tx2);background:#F8FAFC;border-radius:5px}
.c-d{padding:6px;min-height:58px;border-radius:5px;border:1px solid var(--bd2);background:#fff}
.c-d.tdy{background:#EFF6FF;border-color:var(--p2)}
.c-ev{font-size:9px;padding:2px 4px;border-radius:3px;margin-top:1px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}

/* PROFILE CARD */
.pf-av{width:70px;height:70px;border-radius:50%;background:linear-gradient(135deg,var(--p),var(--p2));display:flex;align-items:center;justify-content:center;color:#fff;font-weight:900;font-size:28px;margin:0 auto 12px}

@media(max-width:900px){.sb{transform:translateX(100%)}.sb.open{transform:translateX(0)}.main{margin-right:0}.h-menu{display:flex}.g2,.g3{grid-template-columns:1fr}.m2,.m3{grid-template-columns:1fr}}
@media(max-width:600px){.pg{padding:14px}.g4{grid-template-columns:1fr 1fr}}
</style></head>
<body>

<div class="ld-ov" id="LD"><div class="ld-sp"></div><span style="font-size:12px;color:var(--tx2)">Ø¬Ø§Ø±Ù Ø§Ù„ØªØ­Ù…ÙŠÙ„...</span></div>

<!-- LOGIN -->
<div class="login" id="LOGIN">
  <div class="bg-c bg1"></div><div class="bg-c bg2"></div><div class="bg-c bg3"></div>
  <div class="l-left">
    <div class="l-icon"><svg width="34" height="34" fill="none" stroke="#F59E0B" stroke-width="2" viewBox="0 0 24 24"><path d="m12.83 2.18a2 2 0 0 0-1.66 0L2.6 6.08a1 1 0 0 0 0 1.83l8.58 3.91a2 2 0 0 0 1.66 0l8.58-3.9a1 1 0 0 0 0-1.83Z"/><path d="m22 17.65-9.17 4.16a2 2 0 0 1-1.66 0L2 17.65"/><path d="m22 12.65-9.17 4.16a2 2 0 0 1-1.66 0L2 12.65"/></svg></div>
    <h1>Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹</h1>
    <p>Ù…Ù†ØµØ© Ù…ØªÙƒØ§Ù…Ù„Ø© Ù„Ø¥Ø¯Ø§Ø±Ø© ÙˆÙ…ØªØ§Ø¨Ø¹Ø© Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹ Ø¨ÙƒÙØ§Ø¡Ø© Ø¹Ø§Ù„ÙŠØ©</p>
  </div>
  <div class="l-right">
    <div class="l-card">
      <h2>ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</h2>
      <p class="sub">Ø£Ø¯Ø®Ù„ Ø¨ÙŠØ§Ù†Ø§ØªÙƒ Ù„Ù„ÙˆØµÙˆÙ„ Ø¥Ù„Ù‰ Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</p>
      <div class="l-err" id="lErr"></div>
      <div class="fg"><label>ğŸ‘¤ Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</label><input id="lu" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…"></div>
      <div class="fg"><label>ğŸ”’ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</label><input type="password" id="lp" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±"></div>
      <button class="btn-auth" id="loginBtn" onclick="doLogin()">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</button>
      <div class="l-hint">ğŸ”‘ Ø¨ÙŠØ§Ù†Ø§Øª ØªØ¬Ø±ÙŠØ¨ÙŠØ©: <b onclick="document.getElementById('lu').value='admin'">admin</b> / <b onclick="document.getElementById('lp').value='admin123'">admin123</b></div>
      <div class="l-foot">Â© 2025 Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹ - Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø©</div>
    </div>
  </div>
</div>

<!-- APP -->
<div class="app" id="APP">
  <div class="sb" id="SB">
    <div class="sb-hd"><div class="sb-lg"><svg width="18" height="18" fill="none" stroke="#F59E0B" stroke-width="2" viewBox="0 0 24 24"><path d="m12.83 2.18a2 2 0 00-1.66 0L2.6 6.08a1 1 0 000 1.83l8.58 3.91a2 2 0 001.66 0l8.58-3.9a1 1 0 000-1.83Z"/><path d="m22 17.65-9.17 4.16a2 2 0 01-1.66 0L2 17.65"/><path d="m22 12.65-9.17 4.16a2 2 0 01-1.66 0L2 12.65"/></svg></div><div class="sb-tx"><div class="sb-nm">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹</div><div class="sb-v">PMS v2.0</div></div></div>
    <nav class="sb-nav" id="NAV">
      <div class="sb-sec">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</div>
      <button class="nv on" data-p="dashboard"><span class="nv-ic">ğŸ“Š</span><span>Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</span></button>
      <button class="nv" data-p="calendar"><span class="nv-ic">ğŸ“…</span><span>Ø§Ù„ØªÙ‚ÙˆÙŠÙ…</span></button>
      <button class="nv" data-p="projects"><span class="nv-ic">ğŸ“</span><span>Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹</span></button>
      <button class="nv" data-p="tasks"><span class="nv-ic">âœ…</span><span>Ø§Ù„Ù…Ù‡Ø§Ù…</span></button>
      <div class="sb-sec">Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©</div>
      <button class="nv" data-p="finance"><span class="nv-ic">ğŸ’°</span><span>Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª Ø§Ù„Ù…Ø§Ù„ÙŠØ©</span></button>
      <button class="nv" data-p="hr"><span class="nv-ic">ğŸ‘¥</span><span>Ø§Ù„Ù…ÙˆØ§Ø±Ø¯ Ø§Ù„Ø¨Ø´Ø±ÙŠØ©</span></button>
      <button class="nv" data-p="evaluations"><span class="nv-ic">â­</span><span>Ø§Ù„ØªÙ‚ÙŠÙŠÙ…Ø§Øª</span></button>
      <div class="sb-sec">Ø§Ù„Ù†Ø¸Ø§Ù…</div>
      <button class="nv" data-p="users"><span class="nv-ic">ğŸ”‘</span><span>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†</span></button>
      <button class="nv" data-p="settings"><span class="nv-ic">âš™ï¸</span><span>Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</span></button>
    </nav>
    <div class="sb-ft">
      <div class="sb-av" id="sbAv">Ù…</div>
      <div class="sb-un"><div class="nm" id="sbNm">Ù…Ø¯ÙŠØ± Ø§Ù„Ù†Ø¸Ø§Ù…</div><div class="rl" id="sbRl">Ù…Ø¯ÙŠØ± Ø¹Ø§Ù…</div></div>
      <button class="sb-lo" onclick="doLogout()" title="ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬">ğŸšª</button>
    </div>
  </div>

  <div class="main" id="MN">
    <header class="hdr">
      <div style="display:flex;align-items:center;gap:10px"><button class="h-menu" onclick="document.getElementById('SB').classList.toggle('open')">â˜°</button><h1 id="PT">Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</h1></div>
      <div class="h-r">
        <span style="font-size:12px;color:var(--tx3)" id="todayDate"></span>
        <div class="h-u"><div style="text-align:left"><div class="h-nm" id="HN">Ù…Ø³ØªØ®Ø¯Ù…</div><div class="h-rl" id="HR">Ù…Ø¯ÙŠØ±</div></div><div class="h-av" id="HA">Ù…</div></div>
        <button class="h-lo" onclick="doLogout()">ğŸšª</button>
      </div>
    </header>
    <div class="pg" id="PG"></div>
  </div>
</div>

<!-- MODALS -->
<div class="mo" id="MO" onclick="if(event.target===this)closeMo()"><div class="mo-c" id="MC"></div></div>
<div class="mo" id="MO2" onclick="if(event.target===this)closeMo2()"><div class="mo-c wide" id="MC2"></div></div>

<script>
var SUPA_URL='https://ijbmlykvlbgextjisnry.supabase.co';
var SUPA_KEY='eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImlqYm1seWt2bGJnZXh0amlzbnJ5Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzEzOTk5NDYsImV4cCI6MjA4Njk3NTk0Nn0.zPCzFh_QUQFOYC_8trxcAxwDQHyRZgZAb7eINN7hLpQ';
var H={'apikey':SUPA_KEY,'Authorization':'Bearer '+SUPA_KEY,'Content-Type':'application/json','Prefer':'return=representation'};

// === SUPABASE API ===
async function dbGet(t){try{var r=await fetch(SUPA_URL+'/rest/v1/'+t+'?select=*&order=id.asc',{headers:H});return await r.json()}catch(e){console.error(e);return[]}}
async function dbInsert(t,d){try{var r=await fetch(SUPA_URL+'/rest/v1/'+t,{method:'POST',headers:H,body:JSON.stringify(d)});return await r.json()}catch(e){return null}}
async function dbUpdate(t,id,d){try{await fetch(SUPA_URL+'/rest/v1/'+t+'?id=eq.'+id,{method:'PATCH',headers:H,body:JSON.stringify(d)});return true}catch(e){return false}}
async function dbDelete(t,id){try{await fetch(SUPA_URL+'/rest/v1/'+t+'?id=eq.'+id,{method:'DELETE',headers:H});return true}catch(e){return false}}

// === STATE ===
var users=[],projects=[],tasks=[],evals=[],finData=[],expenses_raw=[];
var page='dashboard',calM,calY,gChart=null,chP=null,chT=null,chW=null,chPa=null,chPr=null,_finIdx=0,curTV='table',curQF='all';
var now=new Date();calM=now.getMonth();calY=now.getFullYear();
var SL={pending:'Ù…Ø¹Ù„Ù‚Ø©','in-progress':'Ù‚ÙŠØ¯ Ø§Ù„ØªÙ†ÙÙŠØ°',completed:'Ù…ÙƒØªÙ…Ù„Ø©'};
var RL={super_admin:'Ù…Ø¯ÙŠØ± Ø¹Ø§Ù…',project_manager:'Ù…Ø¯ÙŠØ± Ù…Ø´Ø±ÙˆØ¹',team_lead:'Ù‚Ø§Ø¦Ø¯ ÙØ±ÙŠÙ‚',employee:'Ù…ÙˆØ¸Ù',viewer:'Ù…Ø´Ø§Ù‡Ø¯'};
var depts=[{n:'Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª Ø§Ù„Ù…Ø§Ù„ÙŠØ©',i:'ğŸ’¼'},{n:'Ø§Ù„Ù…ÙˆØ§Ø±Ø¯ Ø§Ù„Ø¨Ø´Ø±ÙŠØ©',i:'ğŸ‘¥'},{n:'ØªÙ‚Ù†ÙŠØ© Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª',i:'ğŸ’»'},{n:'Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª',i:'âš™ï¸'},{n:'Ø§Ù„Ø±Ù‚Ø§Ø¨Ø© ÙˆØ§Ù„Ø¬ÙˆØ¯Ø©',i:'âœ…'},{n:'Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¹Ø§Ù…Ø©',i:'ğŸ›ï¸'}];
var $=function(id){return document.getElementById(id)};

function ld(on){$('LD').classList.toggle('on',on)}
function toast(m){var t=document.createElement('div');t.className='toast';t.textContent=m;document.body.appendChild(t);setTimeout(function(){t.remove()},2500)}
function openMo(h){$('MC').innerHTML=h;$('MO').classList.add('on')}
function closeMo(){$('MO').classList.remove('on')}
function openMo2(h){$('MC2').innerHTML=h;$('MO2').classList.add('on')}
function closeMo2(){$('MO2').classList.remove('on')}

// === LOAD ALL DATA ===
async function loadAllData(){
  var st=Date.now();
  var [u,p,t,ex,ev]=await Promise.all([dbGet('pms_users'),dbGet('pms_projects'),dbGet('pms_tasks'),dbGet('pms_expenses'),dbGet('pms_evaluations')]);
  users=u.map(function(x){return{id:x.id,u:x.username,p:x.password,n:x.fullname,r:x.role,email:x.email,dept:x.dept,jobTitle:x.job_title,phone:x.phone}});
  projects=p.map(function(x){return{id:x.id,name:x.name,mgr:x.manager,dept:x.dept,status:x.status,risk:x.risk,budget:parseFloat(x.budget)||0,prog:0}});
  tasks=t.map(function(x){return{id:x.id,name:x.name,proj:x.project,assign:x.assignee,w:x.weight||1,due:x.due_date||'',st:x.status,pri:x.priority||'normal'}});
  expenses_raw=ex;
  evals=ev.map(function(x){return{id:x.id,emp:x.employee,task:x.task,s:x.speed,q:x.quality,p:x.commitment}});
  finData=projects.map(function(pr){var exps=expenses_raw.filter(function(e){return e.project_name===pr.name}).map(function(e){return{id:e.id,type:e.type,amt:parseFloat(e.amount)||0,inv:e.invoice||'-'}});return{name:pr.name,budget:pr.budget,exps:exps}});
  console.log('Data loaded in '+(Date.now()-st)+'ms');
}

// === AUTH ===
async function doLogin(){
  var u=$('lu').value.trim(),p=$('lp').value;
  if(!u||!p){$('lErr').textContent='Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª';$('lErr').classList.add('on');return}
  $('loginBtn').innerHTML='<span class="spinner-s"></span> Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...';$('loginBtn').disabled=true;
  await loadAllData();
  var user=users.find(function(x){return x.u===u&&x.p===p});
  if(!user){$('lErr').textContent='Ø¨ÙŠØ§Ù†Ø§Øª ØºÙŠØ± ØµØ­ÙŠØ­Ø©';$('lErr').classList.add('on');$('loginBtn').textContent='ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„';$('loginBtn').disabled=false;return}
  $('sbNm').textContent=user.n;$('sbRl').textContent=RL[user.r];$('sbAv').textContent=user.n[0];
  $('HN').textContent=user.n;$('HR').textContent=RL[user.r];$('HA').textContent=user.n[0];
  $('LOGIN').style.display='none';$('APP').classList.add('on');
  initApp();
}
function doLogout(){$('APP').classList.remove('on');$('LOGIN').style.display='flex';$('loginBtn').textContent='ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„';$('loginBtn').disabled=false}
$('lu').onkeydown=function(e){if(e.key==='Enter')doLogin()};
$('lp').onkeydown=function(e){if(e.key==='Enter')doLogin()};

// === SIDEBAR TOGGLE ===
document.querySelector('.sb-hd').onclick=function(){$('SB').classList.toggle('mini');$('MN').classList.toggle('mini')};

// === NAVIGATION ===
$('NAV').querySelectorAll('.nv').forEach(function(b){b.onclick=function(){go(b.dataset.p)}});
var titles={dashboard:'Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…',calendar:'Ø§Ù„ØªÙ‚ÙˆÙŠÙ…',projects:'Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹',tasks:'Ø§Ù„Ù…Ù‡Ø§Ù…',finance:'Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª Ø§Ù„Ù…Ø§Ù„ÙŠØ©',hr:'Ø§Ù„Ù…ÙˆØ§Ø±Ø¯ Ø§Ù„Ø¨Ø´Ø±ÙŠØ©',evaluations:'Ø§Ù„ØªÙ‚ÙŠÙŠÙ…Ø§Øª',users:'Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†',settings:'Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª'};
function go(p){page=p;$('PT').textContent=titles[p]||p;$('NAV').querySelectorAll('.nv').forEach(function(b){b.classList.toggle('on',b.dataset.p===p)});render();$('SB').classList.remove('open')}

function initApp(){var d=new Date();var days=['Ø§Ù„Ø£Ø­Ø¯','Ø§Ù„Ø§Ø«Ù†ÙŠÙ†','Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡','Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡','Ø§Ù„Ø®Ù…ÙŠØ³','Ø§Ù„Ø¬Ù…Ø¹Ø©','Ø§Ù„Ø³Ø¨Øª'];var months=['ÙŠÙ†Ø§ÙŠØ±','ÙØ¨Ø±Ø§ÙŠØ±','Ù…Ø§Ø±Ø³','Ø£Ø¨Ø±ÙŠÙ„','Ù…Ø§ÙŠÙˆ','ÙŠÙˆÙ†ÙŠÙˆ','ÙŠÙˆÙ„ÙŠÙˆ','Ø£ØºØ³Ø·Ø³','Ø³Ø¨ØªÙ…Ø¨Ø±','Ø£ÙƒØªÙˆØ¨Ø±','Ù†ÙˆÙÙ…Ø¨Ø±','Ø¯ÙŠØ³Ù…Ø¨Ø±'];$('todayDate').textContent=days[d.getDay()]+', '+d.getDate()+' '+months[d.getMonth()]+' '+d.getFullYear();render()}

// === HELPERS ===
function getAllEmps(){return users.map(function(u){var tc=tasks.filter(function(t){return t.assign===u.n}).length;return{id:u.id,name:u.n,email:u.email||'',role:u.jobTitle||RL[u.r],dept:u.dept||'',tasks:tc,avail:tc>0?'busy':'available'}})}
function calcProgress(){projects.forEach(function(p){var pt=tasks.filter(function(t){return t.proj===p.name});p.prog=pt.length?Math.round(pt.filter(function(t){return t.st==='completed'}).length/pt.length*100):0})}
function prg(v){var c=v>=75?'#059669':v>=50?'#0284C7':v>=25?'#F59E0B':'#DC2626';return '<div class="prg"><div class="prg-t"><div class="prg-f" style="width:'+v+'%;background:'+c+'"></div></div><span class="prg-v" style="color:'+c+'">'+v+'%</span></div>'}
function badge(s){var m={'Ù‚ÙŠØ¯ Ø§Ù„ØªÙ†ÙÙŠØ°':'act','Ù…Ø¹ØªÙ…Ø¯':'ok','Ù…Ø³ÙˆØ¯Ø©':'nw','Ù…ØªÙˆÙ‚Ù':'er','Ù…ÙƒØªÙ…Ù„Ø©':'ok','Ù…Ø¹Ù„Ù‚Ø©':'nw','pending':'nw','in-progress':'act','completed':'ok'};return '<span class="bg-s bg-'+(m[s]||'nw')+'"><span class="bg-d"></span>'+(SL[s]||s)+'</span>'}
function prio(p){return '<span class="pr-'+(p==='Ø¹Ø§Ù„ÙŠ'||p==='high'||p==='urgent'?'h':p==='Ù…Ù†Ø®ÙØ¶'||p==='normal'?'l':'m')+'">'+(p==='high'?'Ø¹Ø§Ù„ÙŠØ©':p==='urgent'?'Ø¹Ø§Ø¬Ù„Ø©':p==='normal'?'Ø¹Ø§Ø¯ÙŠØ©':p)+'</span>'}
function usrOpts(){return users.map(function(u){return '<option>'+u.n+'</option>'}).join('')||'<option>Ø£Ø¶Ù Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†</option>'}
function projOpts(){return projects.map(function(p){return '<option>'+p.name+'</option>'}).join('')||'<option>Ø£Ø¶Ù Ù…Ø´Ø§Ø±ÙŠØ¹</option>'}
function taskOpts(){return tasks.map(function(t){return '<option>'+t.name+'</option>'}).join('')||'<option>Ø£Ø¶Ù Ù…Ù‡Ø§Ù…</option>'}

// === MAIN RENDER ===
var _projSearch='',_projStat='all',_projRisk='all',_taskSearch='',_taskStatF='all',_taskProjF='all';
function render(){calcProgress();var fn={dashboard:rDash,calendar:rCal,projects:rProj,tasks:rTask,finance:rFin,hr:rHR,evaluations:rEval,users:rUsers,settings:rSet};$('PG').innerHTML=(fn[page]||rDash)();restoreFilters()}
function restoreFilters(){if($('projSearch'))$('projSearch').value=_projSearch;if($('projStat'))$('projStat').value=_projStat;if($('projRisk'))$('projRisk').value=_projRisk;if($('taskSearch'))$('taskSearch').value=_taskSearch;if($('taskStatF'))$('taskStatF').value=_taskStatF;if($('taskProjF'))$('taskProjF').value=_taskProjF}
function projFilter(){_projSearch=$('projSearch')?$('projSearch').value:'';_projStat=$('projStat')?$('projStat').value:'all';_projRisk=$('projRisk')?$('projRisk').value:'all';$('projTbl').innerHTML=projTblHTML()}
function taskFilter(){_taskSearch=$('taskSearch')?$('taskSearch').value:'';_taskStatF=$('taskStatF')?$('taskStatF').value:'all';_taskProjF=$('taskProjF')?$('taskProjF').value:'all';$('taskTbl').innerHTML=taskTblHTML()}

// === DASHBOARD ===
function rDash(){
  var tc=tasks.filter(function(t){return t.st==='completed'}).length;
  var ip=tasks.filter(function(t){return t.st==='in-progress'}).length;
  var pn=tasks.filter(function(t){return t.st==='pending'}).length;
  var avgP=projects.length?projects.reduce(function(s,p){return s+p.prog},0)/projects.length:0;
  var h='<div style="margin-bottom:14px"><button class="btn btn-ai" onclick="showAI(\'dash\')">âœ¨ ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø£Ø¯Ø§Ø¡ Ø¨Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ</button></div>';
  h+='<div class="g4">'+[
    ['#DBEAFE','#0284C7','ğŸ“',projects.length,'Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹'],
    ['#FEF3C7','#F59E0B','âœ…',tasks.length,'Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ù‡Ø§Ù…'],
    ['#D1FAE5','#059669','ğŸ“ˆ',avgP.toFixed(0)+'%','Ù…ØªÙˆØ³Ø· Ø§Ù„ØªÙ‚Ø¯Ù…'],
    ['#FEE2E2','#DC2626','ğŸ¯',tc,'Ù…ÙƒØªÙ…Ù„Ø©']
  ].map(function(x){return '<div class="st"><div class="st-i" style="background:'+x[0]+'"><span style="color:'+x[1]+';font-size:18px">'+x[2]+'</span></div><div class="st-v" style="color:'+x[1]+'">'+x[3]+'</div><div class="st-l">'+x[4]+'</div></div>'}).join('')+'</div>';
  if(!projects.length&&!tasks.length) return h+'<div class="card"><div class="emp-box"><div style="font-size:40px;margin-bottom:12px">ğŸ“Š</div><div style="font-size:16px;font-weight:700;margin-bottom:5px">Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ</div><div style="font-size:12px;color:var(--tx3);margin-bottom:16px">Ø§Ø¨Ø¯Ø£ Ø¨Ø¥Ø¶Ø§ÙØ© Ù…Ø´Ø§Ø±ÙŠØ¹ ÙˆÙ…Ù‡Ø§Ù…</div><button class="btn btn-p" onclick="go(\'projects\')">+ Ù…Ø´Ø±ÙˆØ¹ Ø¬Ø¯ÙŠØ¯</button></div></div>';
  h+='<div class="g2"><div class="card"><div class="card-t">ğŸ“Š Ø¥Ù†Ø¬Ø§Ø² Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹</div>'+projects.map(function(p){return '<div style="display:flex;align-items:center;gap:10px;margin-bottom:10px"><span style="font-size:11px;font-weight:600;min-width:120px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap">'+p.name+'</span><div style="flex:1">'+prg(p.prog)+'</div></div>'}).join('')+'</div>';
  h+='<div class="card"><div class="card-t">âœ… Ø¢Ø®Ø± Ø§Ù„Ù…Ù‡Ø§Ù…</div>'+tasks.slice(0,6).map(function(t){return '<div style="display:flex;align-items:center;justify-content:space-between;padding:7px 10px;border-radius:8px;background:#F8FAFC;margin-bottom:5px"><span style="font-size:11px;font-weight:600">'+t.name+'</span>'+badge(t.st)+'</div>'}).join('')+(tasks.length?'':'<div style="text-align:center;padding:14px;color:#94A3B8;font-size:11px">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù‡Ø§Ù…</div>')+'</div></div>';
  h+='<div class="card"><div class="card-t">â° Ø§Ù„Ù…Ù‡Ø§Ù… Ø§Ù„Ù‚Ø§Ø¯Ù…Ø©</div><table class="tb"><thead><tr><th>Ø§Ù„Ù…Ù‡Ù…Ø©</th><th>Ø§Ù„Ù…ÙƒÙ„Ù</th><th>Ø§Ù„Ø§Ø³ØªØ­Ù‚Ø§Ù‚</th><th>Ø§Ù„Ø­Ø§Ù„Ø©</th></tr></thead><tbody>'+tasks.filter(function(t){return t.st!=='completed'}).sort(function(a,b){return a.due>b.due?1:-1}).slice(0,8).map(function(t){return '<tr><td style="font-weight:600">'+t.name+'</td><td>'+t.assign+'</td><td>'+t.due+'</td><td>'+badge(t.st)+'</td></tr>'}).join('')+(tasks.length?'':'<tr><td colspan="4" style="text-align:center;padding:20px;color:var(--tx3)">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù‡Ø§Ù…</td></tr>')+'</tbody></table></div>';
  return h;
}

// === PROJECTS ===
function rProj(){
  var h='<div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:14px"><span style="font-size:12px;color:var(--tx2)">Ø¥Ø¬Ù…Ø§Ù„ÙŠ: <b>'+projects.length+'</b></span><button class="btn btn-p" onclick="openAddP()">+ Ù…Ø´Ø±ÙˆØ¹ Ø¬Ø¯ÙŠØ¯</button></div>';
  h+='<div class="fb"><div class="fb-s"><input placeholder="Ø¨Ø­Ø« Ø¨Ø§Ù„Ø§Ø³Ù…ØŒ Ø§Ù„Ù…Ø¯ÙŠØ±ØŒ Ø§Ù„Ù‚Ø³Ù…..." id="projSearch" oninput="projFilter()"><span class="ic">ğŸ”</span></div><select class="fb" id="projStat" onchange="projFilter()"><option value="all">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ø§Ù„Ø§Øª</option><option value="Ù‚ÙŠØ¯ Ø§Ù„ØªÙ†ÙÙŠØ°">Ù‚ÙŠØ¯ Ø§Ù„ØªÙ†ÙÙŠØ°</option><option value="Ù…Ø¹ØªÙ…Ø¯">Ù…Ø¹ØªÙ…Ø¯</option><option value="Ù…Ø³ÙˆØ¯Ø©">Ù…Ø³ÙˆØ¯Ø©</option><option value="Ù…ØªÙˆÙ‚Ù">Ù…ØªÙˆÙ‚Ù</option></select><select class="fb" id="projRisk" onchange="projFilter()"><option value="all">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø®Ø§Ø·Ø±</option><option value="Ø¹Ø§Ù„ÙŠ">Ø¹Ø§Ù„ÙŠ</option><option value="Ù…ØªÙˆØ³Ø·">Ù…ØªÙˆØ³Ø·</option><option value="Ù…Ù†Ø®ÙØ¶">Ù…Ù†Ø®ÙØ¶</option></select></div>';
  h+='<div id="projTbl">'+projTblHTML()+'</div>';
  return h;
}
function projTblHTML(){
  var sf=_projStat,rf=_projRisk,s=_projSearch.toLowerCase();
  var f=projects.filter(function(p){if(sf!=='all'&&p.status!==sf)return false;if(rf!=='all'&&p.risk!==rf)return false;if(s&&p.name.toLowerCase().indexOf(s)===-1&&(p.mgr||'').toLowerCase().indexOf(s)===-1&&(p.dept||'').toLowerCase().indexOf(s)===-1)return false;return true});
  if(!f.length) return '<div class="card"><div class="emp-box"><div style="font-size:36px;margin-bottom:10px">ğŸ“</div><div style="font-size:15px;font-weight:700;margin-bottom:4px">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬</div></div></div>';
  return '<div class="card" style="padding:0;overflow:hidden"><table class="tb"><thead><tr><th>Ø§Ù„Ù…Ø´Ø±ÙˆØ¹</th><th>Ø§Ù„Ù…Ø¯ÙŠØ±</th><th>Ø§Ù„Ù‚Ø³Ù…</th><th>Ø§Ù„Ø­Ø§Ù„Ø©</th><th>Ø§Ù„Ù…Ø®Ø§Ø·Ø±</th><th>Ø§Ù„ØªÙ‚Ø¯Ù…</th><th>Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th></tr></thead><tbody>'+f.map(function(p){return '<tr><td style="font-weight:700">'+p.name+'</td><td style="color:var(--tx2)">'+p.mgr+'</td><td>'+badge(p.dept)+'</td><td>'+badge(p.status)+'</td><td>'+prio(p.risk)+'</td><td>'+prg(p.prog)+'</td><td><button class="btn-e" onclick="editProject('+p.id+')">âœï¸</button> <button class="btn-d" onclick="delProject('+p.id+')">ğŸ—‘ï¸</button></td></tr>'}).join('')+'</tbody></table></div>';
}

// === TASKS ===
function rTask(){
  var h='<div style="display:flex;gap:10px;margin-bottom:14px;flex-wrap:wrap;align-items:center"><button class="btn btn-p" onclick="openAddT()">+ Ù…Ù‡Ù…Ø© Ø¬Ø¯ÙŠØ¯Ø©</button><div style="display:flex;border:1px solid var(--bd);border-radius:8px;overflow:hidden"><button class="qf'+(curTV==='table'?' on':'')+'" onclick="curTV=\'table\';render()" style="border:0;border-radius:0">âŠ Ø¬Ø¯ÙˆÙ„</button><button class="qf'+(curTV==='board'?' on':'')+'" onclick="curTV=\'board\';render()" style="border:0;border-radius:0">âŠŸ Ù„ÙˆØ­Ø©</button></div></div>';
  h+='<div class="fb"><div class="fb-s"><input placeholder="Ø¨Ø­Ø« Ø¨Ø§Ù„Ù…Ù‡Ù…Ø©ØŒ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ØŒ Ø§Ù„Ù…ÙƒÙ„Ù..." id="taskSearch" oninput="taskFilter()"><span class="ic">ğŸ”</span></div><select class="fb" id="taskStatF" onchange="taskFilter()"><option value="all">Ø§Ù„ÙƒÙ„</option><option value="pending">Ù…Ø¹Ù„Ù‚Ø©</option><option value="in-progress">Ù‚ÙŠØ¯ Ø§Ù„ØªÙ†ÙÙŠØ°</option><option value="completed">Ù…ÙƒØªÙ…Ù„Ø©</option></select><select class="fb" id="taskProjF" onchange="taskFilter()"><option value="all">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹</option>'+projects.map(function(p){return '<option>'+p.name+'</option>'}).join('')+'</select></div>';
  h+='<div style="display:flex;gap:6px;flex-wrap:wrap;margin-bottom:14px"><button class="qf'+(curQF==='all'?' on':'')+'" onclick="curQF=\'all\';taskFilter()">â˜° Ø§Ù„ÙƒÙ„</button><button class="qf'+(curQF==='overdue'?' on':'')+'" onclick="curQF=\'overdue\';taskFilter()">â± Ù…ØªØ£Ø®Ø±Ø©</button><button class="qf'+(curQF==='priority'?' on':'')+'" onclick="curQF=\'priority\';taskFilter()">â­ Ø¹Ø§Ù„ÙŠØ©</button></div>';
  h+='<div id="taskTbl">'+taskTblHTML()+'</div>';
  return h;
}
function taskTblHTML(){
  var s=_taskSearch.toLowerCase();var sf=_taskStatF;var pf=_taskProjF;
  var f=tasks.filter(function(t){if(s&&t.name.toLowerCase().indexOf(s)===-1&&(t.proj||'').toLowerCase().indexOf(s)===-1&&(t.assign||'').toLowerCase().indexOf(s)===-1)return false;if(sf!=='all'&&t.st!==sf)return false;if(pf!=='all'&&t.proj!==pf)return false;if(curQF==='overdue'){var d=new Date(t.due);if(d>=new Date()||t.st==='completed')return false}if(curQF==='priority'&&t.pri!=='high'&&t.pri!=='urgent')return false;return true});
  if(curTV==='table'){
    if(!f.length) return '<div class="card"><div class="emp-box"><div style="font-size:36px;margin-bottom:10px">âœ…</div><div style="font-size:15px;font-weight:700">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬</div></div></div>';
    return '<div class="card" style="padding:0;overflow:hidden"><table class="tb"><thead><tr><th>Ø§Ù„Ù…Ù‡Ù…Ø©</th><th>Ø§Ù„Ù…Ø´Ø±ÙˆØ¹</th><th>Ø§Ù„Ù…ÙƒÙ„Ù</th><th>Ø§Ù„Ø§Ø³ØªØ­Ù‚Ø§Ù‚</th><th>Ø§Ù„Ø­Ø§Ù„Ø©</th><th>Ø§Ù„Ø£ÙˆÙ„ÙˆÙŠØ©</th><th>Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th></tr></thead><tbody>'+f.map(function(t){return '<tr><td style="font-weight:700">'+t.name+'</td><td style="color:var(--tx2)">'+t.proj+'</td><td>'+t.assign+'</td><td>'+t.due+'</td><td>'+badge(t.st)+'</td><td>'+prio(t.pri)+'</td><td><button class="btn-e" onclick="editTask('+t.id+')">âœï¸</button> <button class="btn-d" onclick="delTask('+t.id+')">ğŸ—‘ï¸</button></td></tr>'}).join('')+'</tbody></table></div>';
  } else {
    var cols={pending:[],'in-progress':[],completed:[]};f.forEach(function(t){if(cols[t.st])cols[t.st].push(t)});
    return '<div class="board-cols">'+[{k:'pending',l:'Ù…Ø¹Ù„Ù‚Ø©'},{k:'in-progress',l:'Ù‚ÙŠØ¯ Ø§Ù„ØªÙ†ÙÙŠØ°'},{k:'completed',l:'Ù…ÙƒØªÙ…Ù„Ø©'}].map(function(c){return '<div class="board-col"><div class="board-col-hd">'+c.l+'<span class="cnt">'+cols[c.k].length+'</span></div><div class="board-col-bd">'+cols[c.k].map(function(t){return '<div class="b-card"><div class="b-card-t">'+t.name+'</div><div class="b-card-m"><span style="color:var(--p2)">'+t.assign+'</span><span>'+t.due+'</span></div></div>'}).join('')+'</div></div>'}).join('')+'</div>';
  }
}

// === CALENDAR ===
function rCal(){
  var ms=['ÙŠÙ†Ø§ÙŠØ±','ÙØ¨Ø±Ø§ÙŠØ±','Ù…Ø§Ø±Ø³','Ø£Ø¨Ø±ÙŠÙ„','Ù…Ø§ÙŠÙˆ','ÙŠÙˆÙ†ÙŠÙˆ','ÙŠÙˆÙ„ÙŠÙˆ','Ø£ØºØ³Ø·Ø³','Ø³Ø¨ØªÙ…Ø¨Ø±','Ø£ÙƒØªÙˆØ¨Ø±','Ù†ÙˆÙÙ…Ø¨Ø±','Ø¯ÙŠØ³Ù…Ø¨Ø±'];
  var h='<div class="fb"><select class="fb" id="calProj" onchange="render()"><option value="all">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹</option>'+projects.map(function(p){return '<option>'+p.name+'</option>'}).join('')+'</select><button class="btn btn-p" onclick="calM=new Date().getMonth();calY=new Date().getFullYear();render()">Ø§Ù„ÙŠÙˆÙ…</button></div>';
  h+='<div class="card"><div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:14px"><button class="btn" style="background:var(--bg);border:1px solid var(--bd);color:var(--tx)" onclick="calNav(-1)">â†’</button><span style="font-size:16px;font-weight:800">'+ms[calM]+' '+calY+'</span><button class="btn" style="background:var(--bg);border:1px solid var(--bd);color:var(--tx)" onclick="calNav(1)">â†</button></div>';
  h+='<div class="cg"><div class="c-hd">Ø³Ø¨Øª</div><div class="c-hd">Ø£Ø­Ø¯</div><div class="c-hd">Ø§Ø«Ù†ÙŠÙ†</div><div class="c-hd">Ø«Ù„Ø§Ø«Ø§Ø¡</div><div class="c-hd">Ø£Ø±Ø¨Ø¹Ø§Ø¡</div><div class="c-hd">Ø®Ù…ÙŠØ³</div><div class="c-hd">Ø¬Ù…Ø¹Ø©</div>';
  var pf=$('calProj')?$('calProj').value:'all';
  var first=new Date(calY,calM,1).getDay();var start=(first+1)%7;var days=new Date(calY,calM+1,0).getDate();var today=new Date();
  for(var i=0;i<start;i++)h+='<div></div>';
  for(var d=1;d<=days;d++){var ds=calY+'-'+String(calM+1).padStart(2,'0')+'-'+String(d).padStart(2,'0');var isT=(d===today.getDate()&&calM===today.getMonth()&&calY===today.getFullYear());var ev=tasks.filter(function(t){return t.due===ds&&(pf==='all'||t.proj===pf)});
  h+='<div class="c-d'+(isT?' tdy':'')+'"><span style="font-size:11px;font-weight:'+(isT?'800':'600')+';color:'+(isT?'var(--p2)':'var(--tx2)')+'">'+d+'</span>';
  ev.forEach(function(e){var c=e.st==='completed'?'#D1FAE5':e.st==='in-progress'?'#DBEAFE':'#FEF3C7';var tc=e.st==='completed'?'#047857':e.st==='in-progress'?'#1D4ED8':'#92400E';h+='<div class="c-ev" style="background:'+c+';color:'+tc+'">'+e.name+'</div>'});
  h+='</div>'}
  h+='</div></div>';return h;
}
function calNav(dir){calM+=dir;if(calM>11){calM=0;calY++}if(calM<0){calM=11;calY--}render()}

// === FINANCE ===
function rFin(){
  var h='<div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:14px"><span style="font-size:12px;color:var(--tx2)">Ø§Ù„Ø±Ù‚Ø§Ø¨Ø© Ø§Ù„Ù…Ø§Ù„ÙŠØ©</span><button class="btn btn-p" onclick="openAddExp()">+ Ø¥Ø¶Ø§ÙØ© Ù…ØµØ±ÙˆÙ</button></div>';
  h+='<select class="fg-s" style="margin-bottom:16px" id="finProj" onchange="_finIdx=parseInt(this.value);render()">'+finData.map(function(f,i){return '<option value="'+i+'"'+(i===_finIdx?' selected':'')+'>'+f.name+'</option>'}).join('')+(finData.length?'':'<option>Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø´Ø§Ø±ÙŠØ¹</option>')+'</select>';
  if(!finData.length) return h+'<div class="card"><div class="emp-box"><div style="font-size:36px;margin-bottom:10px">ğŸ’°</div><div style="font-size:15px;font-weight:700">Ø£Ø¶Ù Ù…Ø´Ø§Ø±ÙŠØ¹ Ø£ÙˆÙ„Ø§Ù‹</div></div></div>';
  if(_finIdx>=finData.length)_finIdx=0;var p=finData[_finIdx];if(!p)return h;
  var te=p.exps.reduce(function(s,e){return s+e.amt},0);var rem=p.budget-te;var pct=p.budget>0?Math.round(te/p.budget*100):0;
  h+='<div class="g2"><div class="card"><div class="card-t">ğŸ“Š Ø§Ù„Ù…Ù„Ø®Øµ Ø§Ù„Ù…Ø§Ù„ÙŠ</div><div style="font-size:16px;font-weight:800;color:var(--p2);margin-bottom:14px">'+p.name+'</div>';
  h+='<div class="fin-stat"><div style="display:flex;align-items:center;gap:10px"><div class="fin-dot" style="background:var(--p2)"></div><span class="fin-lbl">Ø§Ù„Ù…ÙŠØ²Ø§Ù†ÙŠØ©</span></div><span class="fin-val" style="color:var(--p2)">'+p.budget+' <small style="font-size:12px">Ø±.Ø¹</small></span></div>';
  h+='<div class="fin-stat"><div style="display:flex;align-items:center;gap:10px"><div class="fin-dot" style="background:var(--er)"></div><span class="fin-lbl">Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª</span></div><span class="fin-val" style="color:var(--er)">'+te+' <small style="font-size:12px">Ø±.Ø¹</small></span></div>';
  h+='<div class="fin-stat"><div style="display:flex;align-items:center;gap:10px"><div class="fin-dot" style="background:var(--ok)"></div><span class="fin-lbl">Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ</span></div><span class="fin-val" style="color:var(--ok)">'+rem+' <small style="font-size:12px">Ø±.Ø¹</small></span></div></div>';
  h+='<div class="card"><div class="card-t">ğŸ“ˆ Ø§Ù„Ø§Ø³ØªÙ‡Ù„Ø§Ùƒ</div><div class="gauge-wrap"><div class="gauge-ct"><canvas id="gaugeChart"></canvas><div class="gauge-center"><div class="gauge-pct" id="gaugePct">'+pct+'%</div><div class="gauge-lbl">Ø§Ù„Ø§Ø³ØªÙ‡Ù„Ø§Ùƒ</div></div></div></div></div></div>';
  h+='<div class="card" style="padding:0;overflow:hidden"><table class="tb"><thead><tr><th>Ø§Ù„Ù†ÙˆØ¹</th><th>Ø§Ù„Ù…Ø¨Ù„Øº</th><th>Ø§Ù„ÙØ§ØªÙˆØ±Ø©</th><th></th></tr></thead><tbody>'+(p.exps.length?p.exps.map(function(e){return '<tr><td style="font-weight:600">'+e.type+'</td><td style="font-weight:800;color:var(--er)">'+e.amt+' Ø±.Ø¹</td><td style="color:var(--tx3)">'+e.inv+'</td><td><button class="btn-d" onclick="delExpense('+e.id+')">ğŸ—‘ï¸</button></td></tr>'}).join(''):'<tr><td colspan="4" style="text-align:center;padding:20px;color:var(--tx3)">Ù„Ø§ Ù…ØµØ±ÙˆÙØ§Øª</td></tr>')+'</tbody></table></div>';
  var tb=0,tex=0;h+='<div class="card"><div class="card-t">ğŸ“‹ Ù…Ù„Ø®Øµ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹</div><table class="tb"><thead><tr><th>Ø§Ù„Ù…Ø´Ø±ÙˆØ¹</th><th>Ø§Ù„Ù…ÙŠØ²Ø§Ù†ÙŠØ©</th><th>Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª</th><th>Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ</th><th>Ø§Ù„Ù†Ø³Ø¨Ø©</th></tr></thead><tbody>'+finData.map(function(f){var ex=f.exps.reduce(function(s,e){return s+e.amt},0);tb+=f.budget;tex+=ex;var pc=f.budget>0?Math.round(ex/f.budget*100):0;return '<tr><td style="font-weight:700">'+f.name+'</td><td style="color:var(--p2);font-weight:700">'+f.budget+'</td><td style="color:var(--er);font-weight:700">'+ex+'</td><td style="color:var(--ok);font-weight:700">'+(f.budget-ex)+'</td><td>'+prg(pc)+'</td></tr>'}).join('')+'<tr style="border-top:2px solid var(--bd);font-weight:800"><td>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</td><td style="color:var(--p2)">'+tb+'</td><td style="color:var(--er)">'+tex+'</td><td style="color:var(--ok)">'+(tb-tex)+'</td><td></td></tr></tbody></table></div>';
  setTimeout(function(){if(!document.getElementById('gaugeChart'))return;if(gChart)gChart.destroy();gChart=new Chart(document.getElementById('gaugeChart'),{type:'doughnut',data:{datasets:[{data:[te,Math.max(rem,0)],backgroundColor:['rgba(220,38,38,.8)','rgba(5,150,105,.6)'],borderWidth:0,circumference:270,rotation:225}]},options:{responsive:true,maintainAspectRatio:true,cutout:'72%',plugins:{legend:{display:false},tooltip:{enabled:false}}}})},100);
  return h;
}

// === HR ===
function rHR(){
  var all=getAllEmps();var avail=all.filter(function(e){return e.avail==='available'}).length;
  var h='<div style="margin-bottom:14px"><button class="btn btn-ai" onclick="showAI(\'hr\')">âœ¨ ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ù…ÙˆØ§Ø±Ø¯ Ø§Ù„Ø¨Ø´Ø±ÙŠØ©</button></div>';
  h+='<div class="g4">'+[['#DBEAFE','#0284C7','ğŸ‘¥',all.length,'Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†'],['#D1FAE5','#059669','âœ…',avail,'Ù…ØªØ§Ø­ÙˆÙ†'],['#FEF3C7','#F59E0B','â±ï¸',all.length-avail,'Ù…Ø´ØºÙˆÙ„ÙˆÙ†'],['#EDE9FE','#7C3AED','ğŸ¢',new Set(all.map(function(e){return e.dept})).size,'Ø£Ù‚Ø³Ø§Ù…']].map(function(x){return '<div class="st"><div class="st-i" style="background:'+x[0]+'"><span style="color:'+x[1]+';font-size:18px">'+x[2]+'</span></div><div class="st-v" style="color:'+x[1]+'">'+x[3]+'</div><div class="st-l">'+x[4]+'</div></div>'}).join('')+'</div>';
  h+=depts.map(function(d){var de=all.filter(function(e){return e.dept===d.n});return '<div class="dept-card open"><div class="dept-hd" onclick="this.parentElement.classList.toggle(\'open\')"><div class="dept-ic">'+d.i+'</div><div><div class="dept-nm">'+d.n+'</div><div class="dept-cnt">'+de.length+' Ù…ÙˆØ¸Ù</div></div><div class="dept-tgl">â–¼</div></div><div class="dept-bd">'+(de.length?de.map(function(e){return '<div class="emp-row"><div class="emp-av">ğŸ‘¤</div><div class="emp-info"><div class="emp-nm">'+e.name+'</div><div class="emp-rl">'+e.role+'</div></div>'+badge(e.avail==='available'?'Ù…Ø¹ØªÙ…Ø¯':'Ù‚ÙŠØ¯ Ø§Ù„ØªÙ†ÙÙŠØ°')+'</div>'}).join(''):'<div style="padding:16px;text-align:center;color:var(--tx3)">Ù„Ø§ ÙŠÙˆØ¬Ø¯</div>')+'</div></div>'}).join('');
  return h;
}

// === EVALUATIONS ===
function starsHTML(v){var h='<span class="stars">';for(var i=1;i<=10;i++)h+='<span class="star'+(i<=v?' on':'')+'">â˜…</span>';return h+'</span> <b style="font-size:13px;margin-right:4px">'+v+'</b>'}
function rEval(){
  var h='<div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:14px"><span style="font-size:12px;color:var(--tx2)">Ø¥Ø¬Ù…Ø§Ù„ÙŠ: <b>'+evals.length+'</b></span><div style="display:flex;gap:8px"><button class="btn btn-ai" onclick="showAI(\'eval\')">âœ¨ ØªØ­Ù„ÙŠÙ„</button><button class="btn btn-p" onclick="openAddEval()">+ ØªÙ‚ÙŠÙŠÙ… Ø¬Ø¯ÙŠØ¯</button></div></div>';
  if(!evals.length) return h+'<div class="card"><div class="emp-box"><div style="font-size:36px;margin-bottom:10px">â­</div><div style="font-size:15px;font-weight:700">Ù„Ø§ ØªÙˆØ¬Ø¯ ØªÙ‚ÙŠÙŠÙ…Ø§Øª</div></div></div>';
  h+='<div class="card" style="padding:0;overflow:hidden"><table class="tb"><thead><tr><th>Ø§Ù„Ù…ÙˆØ¸Ù</th><th>Ø§Ù„Ù…Ù‡Ù…Ø©</th><th>Ø§Ù„Ø³Ø±Ø¹Ø©</th><th>Ø§Ù„Ø¬ÙˆØ¯Ø©</th><th>Ø§Ù„Ø§Ù„ØªØ²Ø§Ù…</th><th>Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹</th><th>Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th></tr></thead><tbody>'+evals.map(function(e){var t=e.s+e.q+e.p;var cls=t>=24?'ok':t>=18?'act':t>=12?'nw':'er';return '<tr><td style="color:var(--p2);font-weight:700">'+e.emp+'</td><td>'+e.task+'</td><td>'+starsHTML(e.s)+'</td><td>'+starsHTML(e.q)+'</td><td>'+starsHTML(e.p)+'</td><td><span class="bg-s bg-'+cls+'"><b style="font-size:13px">'+t+'</b>/30</span></td><td><button class="btn-e" onclick="editEval('+e.id+')">âœï¸</button> <button class="btn-d" onclick="delEval('+e.id+')">ğŸ—‘ï¸</button></td></tr>'}).join('')+'</tbody></table></div>';
  return h;
}

// === USERS ===
function rUsers(){
  var h='<div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:14px"><span style="font-size:12px;color:var(--tx2)">Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†: <b>'+users.length+'</b></span><button class="btn btn-p" onclick="openAddUser()">+ Ù…Ø³ØªØ®Ø¯Ù… Ø¬Ø¯ÙŠØ¯</button></div>';
  h+='<div class="g4">'+[['#DBEAFE','#0284C7','ğŸ‘¥',users.length,'Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†'],['#EDE9FE','#7C3AED','ğŸ›¡ï¸',users.filter(function(u){return u.r==='super_admin'}).length,'Ù…Ø¯ÙŠØ± Ø¹Ø§Ù…'],['#D1FAE5','#059669','ğŸ“',users.filter(function(u){return u.r==='project_manager'}).length,'Ù…Ø¯ÙŠØ± Ù…Ø´Ø±ÙˆØ¹'],['#FEF3C7','#F59E0B','ğŸ‘¤',users.filter(function(u){return u.r!=='super_admin'&&u.r!=='project_manager'}).length,'Ù…ÙˆØ¸ÙÙŠÙ†']].map(function(x){return '<div class="st"><div class="st-i" style="background:'+x[0]+'"><span style="color:'+x[1]+';font-size:18px">'+x[2]+'</span></div><div class="st-v" style="color:'+x[1]+'">'+x[3]+'</div><div class="st-l">'+x[4]+'</div></div>'}).join('')+'</div>';
  h+='<div class="card" style="padding:0;overflow:hidden"><table class="tb"><thead><tr><th>Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</th><th>Ø§Ù„Ø¨Ø±ÙŠØ¯</th><th>Ø§Ù„Ø¯ÙˆØ±</th><th>Ø§Ù„Ù‚Ø³Ù…</th><th>Ø§Ù„ÙˆØ¸ÙŠÙØ©</th><th>Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th></tr></thead><tbody>'+users.map(function(u){return '<tr><td><div style="display:flex;align-items:center;gap:8px"><div style="width:32px;height:32px;border-radius:8px;background:linear-gradient(135deg,var(--p),var(--p2));display:flex;align-items:center;justify-content:center;color:#fff;font-weight:700;font-size:13px">'+u.n[0]+'</div><div><b style="font-size:12px">'+u.n+'</b><div style="font-size:10px;color:var(--tx3)">@'+u.u+'</div></div></div></td><td style="font-size:11px;color:var(--tx3)">'+(u.email||'-')+'</td><td>'+badge(RL[u.r])+'</td><td>'+badge(u.dept||'-')+'</td><td style="font-size:11px">'+(u.jobTitle||'-')+'</td><td><button class="btn-e" onclick="editUser('+u.id+')">âœï¸</button>'+(u.u!=='admin'?' <button class="btn-d" onclick="delUser('+u.id+')">ğŸ—‘ï¸</button>':'')+'</td></tr>'}).join('')+'</tbody></table></div>';
  return h;
}

// === SETTINGS ===
function rSet(){return '<div class="g2"><div class="card"><div class="card-t">âš™ï¸ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù†Ø¸Ø§Ù…</div>'+[['Ø§Ù„Ø¥ØµØ¯Ø§Ø±','v2.0'],['Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª','Supabase'],['Ø¢Ø®Ø± ØªØ­Ø¯ÙŠØ«','2026']].map(function(x){return '<div style="display:flex;justify-content:space-between;padding:10px 0;border-bottom:1px solid var(--bd2)"><span style="font-size:12px;color:var(--tx2)">'+x[0]+'</span><span style="font-size:12px;font-weight:700">'+x[1]+'</span></div>'}).join('')+'</div><div class="card"><div class="card-t">ğŸ“Š Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª</div>'+[['Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹',projects.length],['Ø§Ù„Ù…Ù‡Ø§Ù…',tasks.length],['Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†',users.length],['Ø§Ù„ØªÙ‚ÙŠÙŠÙ…Ø§Øª',evals.length]].map(function(x){return '<div style="display:flex;justify-content:space-between;padding:10px 0;border-bottom:1px solid var(--bd2)"><span style="font-size:12px;color:var(--tx2)">'+x[0]+'</span><span style="font-size:12px;font-weight:800;color:var(--p2)">'+x[1]+'</span></div>'}).join('')+'</div></div>';}

// === ADD/EDIT/DELETE - PROJECTS ===
function openAddP(){openMo('<h3>Ù…Ø´Ø±ÙˆØ¹ Ø¬Ø¯ÙŠØ¯ <button onclick="closeMo()">âœ•</button></h3><div class="fg"><label>Ø§Ø³Ù… Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ *</label><input class="fg-s" id="pN"></div><div class="fg"><label>Ø§Ù„Ù…Ø¯ÙŠØ±</label><select class="fg-s" id="pM">'+usrOpts()+'</select></div><div class="m2"><div class="fg"><label>Ø§Ù„Ù‚Ø³Ù…</label><select class="fg-s" id="pD"><option>ØªÙ‚Ù†ÙŠØ© Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª</option><option>Ø§Ù„Ù…ÙˆØ§Ø±Ø¯ Ø§Ù„Ø¨Ø´Ø±ÙŠØ©</option><option>Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª Ø§Ù„Ù…Ø§Ù„ÙŠØ©</option><option>Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª</option><option>Ø§Ù„Ø±Ù‚Ø§Ø¨Ø© ÙˆØ§Ù„Ø¬ÙˆØ¯Ø©</option></select></div><div class="fg"><label>Ø§Ù„Ù…ÙŠØ²Ø§Ù†ÙŠØ© (Ø±.Ø¹)</label><input class="fg-s" type="number" id="pB" value="0"></div></div><div class="m2"><div class="fg"><label>Ø§Ù„Ø­Ø§Ù„Ø©</label><select class="fg-s" id="pS"><option>Ù‚ÙŠØ¯ Ø§Ù„ØªÙ†ÙÙŠØ°</option><option>Ù…Ø¹ØªÙ…Ø¯</option><option>Ù…Ø³ÙˆØ¯Ø©</option><option>Ù…ØªÙˆÙ‚Ù</option></select></div><div class="fg"><label>Ø§Ù„Ù…Ø®Ø§Ø·Ø±</label><select class="fg-s" id="pR"><option>Ù…Ù†Ø®ÙØ¶</option><option>Ù…ØªÙˆØ³Ø·</option><option>Ø¹Ø§Ù„ÙŠ</option></select></div></div><button class="btn-sub" id="pSave" onclick="addProject()">Ø¥Ø¶Ø§ÙØ©</button>')}
async function addProject(){var n=$('pN').value.trim();if(!n)return;ld(true);closeMo();var b=parseFloat($('pB').value)||0;var res=await dbInsert('pms_projects',{name:n,manager:$('pM').value,dept:$('pD').value,status:$('pS').value,risk:$('pR').value,budget:b});if(res&&res[0]){projects.push({id:res[0].id,name:n,mgr:res[0].manager,dept:res[0].dept,status:res[0].status,risk:res[0].risk,budget:b,prog:0});finData.push({name:n,budget:b,exps:[]})}ld(false);render();toast('ØªÙ…Øª Ø§Ù„Ø¥Ø¶Ø§ÙØ© âœ…')}
async function delProject(id){var p=projects.find(function(x){return x.id===id});if(!p||!confirm('Ø­Ø°Ù '+p.name+'ØŸ'))return;ld(true);await dbDelete('pms_projects',id);projects=projects.filter(function(x){return x.id!==id});finData=finData.filter(function(x){return x.name!==p.name});ld(false);render();toast('ØªÙ… Ø§Ù„Ø­Ø°Ù')}
function editProject(id){var p=projects.find(function(x){return x.id===id});if(!p)return;openMo('<h3>ØªØ¹Ø¯ÙŠÙ„ Ù…Ø´Ø±ÙˆØ¹ <button onclick="closeMo()">âœ•</button></h3><div class="fg"><label>Ø§Ø³Ù… Ø§Ù„Ù…Ø´Ø±ÙˆØ¹</label><input class="fg-s" id="pN" value="'+p.name+'"></div><div class="fg"><label>Ø§Ù„Ù…Ø¯ÙŠØ±</label><select class="fg-s" id="pM">'+users.map(function(u){return '<option'+(u.n===p.mgr?' selected':'')+'>'+u.n+'</option>'}).join('')+'</select></div><div class="m2"><div class="fg"><label>Ø§Ù„Ù‚Ø³Ù…</label><select class="fg-s" id="pD">'+['ØªÙ‚Ù†ÙŠØ© Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª','Ø§Ù„Ù…ÙˆØ§Ø±Ø¯ Ø§Ù„Ø¨Ø´Ø±ÙŠØ©','Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª Ø§Ù„Ù…Ø§Ù„ÙŠØ©','Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª','Ø§Ù„Ø±Ù‚Ø§Ø¨Ø© ÙˆØ§Ù„Ø¬ÙˆØ¯Ø©'].map(function(d){return '<option'+(d===p.dept?' selected':'')+'>'+d+'</option>'}).join('')+'</select></div><div class="fg"><label>Ø§Ù„Ù…ÙŠØ²Ø§Ù†ÙŠØ©</label><input class="fg-s" type="number" id="pB" value="'+p.budget+'"></div></div><div class="m2"><div class="fg"><label>Ø§Ù„Ø­Ø§Ù„Ø©</label><select class="fg-s" id="pS">'+['Ù‚ÙŠØ¯ Ø§Ù„ØªÙ†ÙÙŠØ°','Ù…Ø¹ØªÙ…Ø¯','Ù…Ø³ÙˆØ¯Ø©','Ù…ØªÙˆÙ‚Ù'].map(function(s){return '<option'+(s===p.status?' selected':'')+'>'+s+'</option>'}).join('')+'</select></div><div class="fg"><label>Ø§Ù„Ù…Ø®Ø§Ø·Ø±</label><select class="fg-s" id="pR">'+['Ù…Ù†Ø®ÙØ¶','Ù…ØªÙˆØ³Ø·','Ø¹Ø§Ù„ÙŠ'].map(function(r){return '<option'+(r===p.risk?' selected':'')+'>'+r+'</option>'}).join('')+'</select></div></div><button class="btn-sub" onclick="saveEditP('+id+')">Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª</button>')}
async function saveEditP(id){var n=$('pN').value.trim();if(!n)return;ld(true);closeMo();var b=parseFloat($('pB').value)||0;await dbUpdate('pms_projects',id,{name:n,manager:$('pM').value,dept:$('pD').value,status:$('pS').value,risk:$('pR').value,budget:b});var p=projects.find(function(x){return x.id===id});if(p){var old=p.name;p.name=n;p.mgr=$('pM').value;p.dept=$('pD').value;p.status=$('pS').value;p.risk=$('pR').value;p.budget=b;var fd=finData.find(function(f){return f.name===old});if(fd){fd.name=n;fd.budget=b}}ld(false);render();toast('ØªÙ… Ø§Ù„ØªØ­Ø¯ÙŠØ« âœ…')}

// === ADD/EDIT/DELETE - TASKS ===
function openAddT(){openMo('<h3>Ù…Ù‡Ù…Ø© Ø¬Ø¯ÙŠØ¯Ø© <button onclick="closeMo()">âœ•</button></h3><div class="fg"><label>Ø§Ø³Ù… Ø§Ù„Ù…Ù‡Ù…Ø© *</label><input class="fg-s" id="tN"></div><div class="m2"><div class="fg"><label>Ø§Ù„Ù…Ø´Ø±ÙˆØ¹</label><select class="fg-s" id="tP">'+projOpts()+'</select></div><div class="fg"><label>Ø§Ù„Ù…ÙƒÙ„Ù</label><select class="fg-s" id="tA">'+usrOpts()+'</select></div></div><div class="m2"><div class="fg"><label>Ø§Ù„Ø§Ø³ØªØ­Ù‚Ø§Ù‚</label><input class="fg-s" type="date" id="tD"></div><div class="fg"><label>Ø§Ù„Ø­Ø§Ù„Ø©</label><select class="fg-s" id="tS"><option value="pending">Ù…Ø¹Ù„Ù‚Ø©</option><option value="in-progress">Ù‚ÙŠØ¯ Ø§Ù„ØªÙ†ÙÙŠØ°</option><option value="completed">Ù…ÙƒØªÙ…Ù„Ø©</option></select></div></div><div class="fg"><label>Ø§Ù„Ø£ÙˆÙ„ÙˆÙŠØ©</label><select class="fg-s" id="tPr"><option value="normal">Ø¹Ø§Ø¯ÙŠØ©</option><option value="high">Ø¹Ø§Ù„ÙŠØ©</option><option value="urgent">Ø¹Ø§Ø¬Ù„Ø©</option></select></div><button class="btn-sub" onclick="addTask()">Ø¥Ø¶Ø§ÙØ©</button>')}
async function addTask(){var n=$('tN').value.trim();if(!n)return;ld(true);closeMo();var res=await dbInsert('pms_tasks',{name:n,project:$('tP').value,assignee:$('tA').value,due_date:$('tD').value,status:$('tS').value,priority:$('tPr').value});if(res&&res[0])tasks.push({id:res[0].id,name:n,proj:res[0].project,assign:res[0].assignee,w:1,due:res[0].due_date,st:res[0].status,pri:res[0].priority});ld(false);render();toast('ØªÙ…Øª Ø§Ù„Ø¥Ø¶Ø§ÙØ© âœ…')}
async function delTask(id){if(!confirm('Ø­Ø°ÙØŸ'))return;ld(true);await dbDelete('pms_tasks',id);tasks=tasks.filter(function(x){return x.id!==id});ld(false);render();toast('ØªÙ… Ø§Ù„Ø­Ø°Ù')}
function editTask(id){var t=tasks.find(function(x){return x.id===id});if(!t)return;openMo('<h3>ØªØ¹Ø¯ÙŠÙ„ Ù…Ù‡Ù…Ø© <button onclick="closeMo()">âœ•</button></h3><div class="fg"><label>Ø§Ø³Ù… Ø§Ù„Ù…Ù‡Ù…Ø©</label><input class="fg-s" id="tN" value="'+t.name+'"></div><div class="m2"><div class="fg"><label>Ø§Ù„Ù…Ø´Ø±ÙˆØ¹</label><select class="fg-s" id="tP">'+projects.map(function(p){return '<option'+(p.name===t.proj?' selected':'')+'>'+p.name+'</option>'}).join('')+'</select></div><div class="fg"><label>Ø§Ù„Ù…ÙƒÙ„Ù</label><select class="fg-s" id="tA">'+users.map(function(u){return '<option'+(u.n===t.assign?' selected':'')+'>'+u.n+'</option>'}).join('')+'</select></div></div><div class="m2"><div class="fg"><label>Ø§Ù„Ø§Ø³ØªØ­Ù‚Ø§Ù‚</label><input class="fg-s" type="date" id="tD" value="'+t.due+'"></div><div class="fg"><label>Ø§Ù„Ø­Ø§Ù„Ø©</label><select class="fg-s" id="tS">'+[['pending','Ù…Ø¹Ù„Ù‚Ø©'],['in-progress','Ù‚ÙŠØ¯ Ø§Ù„ØªÙ†ÙÙŠØ°'],['completed','Ù…ÙƒØªÙ…Ù„Ø©']].map(function(s){return '<option value="'+s[0]+'"'+(s[0]===t.st?' selected':'')+'>'+s[1]+'</option>'}).join('')+'</select></div></div><div class="fg"><label>Ø§Ù„Ø£ÙˆÙ„ÙˆÙŠØ©</label><select class="fg-s" id="tPr">'+[['normal','Ø¹Ø§Ø¯ÙŠØ©'],['high','Ø¹Ø§Ù„ÙŠØ©'],['urgent','Ø¹Ø§Ø¬Ù„Ø©']].map(function(p){return '<option value="'+p[0]+'"'+(p[0]===t.pri?' selected':'')+'>'+p[1]+'</option>'}).join('')+'</select></div><button class="btn-sub" onclick="saveEditT('+id+')">Ø­ÙØ¸</button>')}
async function saveEditT(id){ld(true);closeMo();await dbUpdate('pms_tasks',id,{name:$('tN').value,project:$('tP').value,assignee:$('tA').value,due_date:$('tD').value,status:$('tS').value,priority:$('tPr').value});var t=tasks.find(function(x){return x.id===id});if(t){t.name=$('tN').value;t.proj=$('tP').value;t.assign=$('tA').value;t.due=$('tD').value;t.st=$('tS').value;t.pri=$('tPr').value}ld(false);render();toast('ØªÙ… Ø§Ù„ØªØ­Ø¯ÙŠØ« âœ…')}

// === EXPENSES ===
function openAddExp(){openMo('<h3>Ø¥Ø¶Ø§ÙØ© Ù…ØµØ±ÙˆÙ <button onclick="closeMo()">âœ•</button></h3><div class="fg"><label>ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…ÙŠØ²Ø§Ù†ÙŠØ© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label><input class="fg-s" type="number" id="eBgt" placeholder="Ø§ØªØ±ÙƒÙ‡ ÙØ§Ø±ØºØ§Ù‹"></div><div class="fg"><label>Ø§Ù„Ù†ÙˆØ¹</label><select class="fg-s" id="eTyp"><option>Ù…Ø´ØªØ±ÙŠØ§Øª</option><option>Ø±ÙˆØ§ØªØ¨</option><option>Ø®Ø¯Ù…Ø§Øª</option><option>Ø§Ø³ØªØ´Ø§Ø±Ø§Øª</option><option>ØªØ¬Ù‡ÙŠØ²Ø§Øª</option></select></div><div class="m2"><div class="fg"><label>Ø§Ù„Ù…Ø¨Ù„Øº</label><input class="fg-s" type="number" id="eAmt"></div><div class="fg"><label>Ø§Ù„ÙØ§ØªÙˆØ±Ø©</label><input class="fg-s" id="eInv" placeholder="Ø§Ø®ØªÙŠØ§Ø±ÙŠ"></div></div><button class="btn-sub" onclick="addExpense()">Ø¥Ø¶Ø§ÙØ©</button>')}
async function addExpense(){var a=parseFloat($('eAmt').value);var b=parseFloat($('eBgt').value);if(!a&&!b){toast('Ø£Ø¯Ø®Ù„ Ù…Ø¨Ù„Øº');return}if(!finData[_finIdx])return;ld(true);closeMo();if(b){finData[_finIdx].budget=b;var pr=projects.find(function(p){return p.name===finData[_finIdx].name});if(pr){pr.budget=b;await dbUpdate('pms_projects',pr.id,{budget:b})}}if(a){var res=await dbInsert('pms_expenses',{project_name:finData[_finIdx].name,type:$('eTyp').value,amount:a,invoice:$('eInv').value||'-'});if(res&&res[0])finData[_finIdx].exps.push({id:res[0].id,type:res[0].type,amt:a,inv:res[0].invoice||'-'})}ld(false);render();toast('ØªÙ…Øª Ø§Ù„Ø¥Ø¶Ø§ÙØ© âœ…')}
async function delExpense(id){if(!confirm('Ø­Ø°ÙØŸ'))return;ld(true);await dbDelete('pms_expenses',id);finData[_finIdx].exps=finData[_finIdx].exps.filter(function(x){return x.id!==id});ld(false);render();toast('ØªÙ… Ø§Ù„Ø­Ø°Ù')}

// === EVALUATIONS ===
function openAddEval(){openMo('<h3>ØªÙ‚ÙŠÙŠÙ… Ø¬Ø¯ÙŠØ¯ <button onclick="closeMo()">âœ•</button></h3><div class="m2"><div class="fg"><label>Ø§Ù„Ù…ÙˆØ¸Ù</label><select class="fg-s" id="evE">'+usrOpts()+'</select></div><div class="fg"><label>Ø§Ù„Ù…Ù‡Ù…Ø©</label><select class="fg-s" id="evT">'+taskOpts()+'</select></div></div><div class="m3"><div class="fg" style="text-align:center"><label>Ø§Ù„Ø³Ø±Ø¹Ø©</label><input class="fg-s" type="number" id="evS" value="5" min="1" max="10" style="text-align:center;font-weight:800;font-size:18px"></div><div class="fg" style="text-align:center"><label>Ø§Ù„Ø¬ÙˆØ¯Ø©</label><input class="fg-s" type="number" id="evQ" value="5" min="1" max="10" style="text-align:center;font-weight:800;font-size:18px"></div><div class="fg" style="text-align:center"><label>Ø§Ù„Ø§Ù„ØªØ²Ø§Ù…</label><input class="fg-s" type="number" id="evP" value="5" min="1" max="10" style="text-align:center;font-weight:800;font-size:18px"></div></div><button class="btn-sub" onclick="addEval()">Ø¥Ø¶Ø§ÙØ©</button>')}
async function addEval(){ld(true);closeMo();var res=await dbInsert('pms_evaluations',{employee:$('evE').value,task:$('evT').value,speed:+$('evS').value,quality:+$('evQ').value,commitment:+$('evP').value});if(res&&res[0])evals.push({id:res[0].id,emp:res[0].employee,task:res[0].task,s:res[0].speed,q:res[0].quality,p:res[0].commitment});ld(false);render();toast('ØªÙ…Øª Ø§Ù„Ø¥Ø¶Ø§ÙØ© âœ…')}
async function delEval(id){if(!confirm('Ø­Ø°ÙØŸ'))return;ld(true);await dbDelete('pms_evaluations',id);evals=evals.filter(function(x){return x.id!==id});ld(false);render();toast('ØªÙ… Ø§Ù„Ø­Ø°Ù')}
function editEval(id){var e=evals.find(function(x){return x.id===id});if(!e)return;openMo('<h3>ØªØ¹Ø¯ÙŠÙ„ ØªÙ‚ÙŠÙŠÙ… <button onclick="closeMo()">âœ•</button></h3><div class="m2"><div class="fg"><label>Ø§Ù„Ù…ÙˆØ¸Ù</label><select class="fg-s" id="evE">'+users.map(function(u){return '<option'+(u.n===e.emp?' selected':'')+'>'+u.n+'</option>'}).join('')+'</select></div><div class="fg"><label>Ø§Ù„Ù…Ù‡Ù…Ø©</label><select class="fg-s" id="evT">'+tasks.map(function(t){return '<option'+(t.name===e.task?' selected':'')+'>'+t.name+'</option>'}).join('')+'</select></div></div><div class="m3"><div class="fg" style="text-align:center"><label>Ø§Ù„Ø³Ø±Ø¹Ø©</label><input class="fg-s" type="number" id="evS" value="'+e.s+'" min="1" max="10" style="text-align:center;font-weight:800;font-size:18px"></div><div class="fg" style="text-align:center"><label>Ø§Ù„Ø¬ÙˆØ¯Ø©</label><input class="fg-s" type="number" id="evQ" value="'+e.q+'" min="1" max="10" style="text-align:center;font-weight:800;font-size:18px"></div><div class="fg" style="text-align:center"><label>Ø§Ù„Ø§Ù„ØªØ²Ø§Ù…</label><input class="fg-s" type="number" id="evP" value="'+e.p+'" min="1" max="10" style="text-align:center;font-weight:800;font-size:18px"></div></div><button class="btn-sub" onclick="saveEditEv('+id+')">Ø­ÙØ¸</button>')}
async function saveEditEv(id){ld(true);closeMo();await dbUpdate('pms_evaluations',id,{employee:$('evE').value,task:$('evT').value,speed:+$('evS').value,quality:+$('evQ').value,commitment:+$('evP').value});var e=evals.find(function(x){return x.id===id});if(e){e.emp=$('evE').value;e.task=$('evT').value;e.s=+$('evS').value;e.q=+$('evQ').value;e.p=+$('evP').value}ld(false);render();toast('ØªÙ… Ø§Ù„ØªØ­Ø¯ÙŠØ« âœ…')}

// === USERS ===
function openAddUser(){openMo('<h3>Ù…Ø³ØªØ®Ø¯Ù… Ø¬Ø¯ÙŠØ¯ <button onclick="closeMo()">âœ•</button></h3><div class="m2"><div class="fg"><label>Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„ *</label><input class="fg-s" id="uN"></div><div class="fg"><label>Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… *</label><input class="fg-s" id="uU" placeholder="Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠ"></div></div><div class="m2"><div class="fg"><label>Ø§Ù„Ø¨Ø±ÙŠØ¯</label><input class="fg-s" id="uE" type="email"></div><div class="fg"><label>ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± *</label><input class="fg-s" id="uP" type="password"></div></div><div class="m2"><div class="fg"><label>Ø§Ù„Ø¯ÙˆØ±</label><select class="fg-s" id="uR"><option value="super_admin">Ù…Ø¯ÙŠØ± Ø¹Ø§Ù…</option><option value="project_manager">Ù…Ø¯ÙŠØ± Ù…Ø´Ø±ÙˆØ¹</option><option value="team_lead">Ù‚Ø§Ø¦Ø¯ ÙØ±ÙŠÙ‚</option><option value="employee" selected>Ù…ÙˆØ¸Ù</option><option value="viewer">Ù…Ø´Ø§Ù‡Ø¯</option></select></div><div class="fg"><label>Ø§Ù„Ù‚Ø³Ù…</label><select class="fg-s" id="uD"><option>ØªÙ‚Ù†ÙŠØ© Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª</option><option>Ø§Ù„Ù…ÙˆØ§Ø±Ø¯ Ø§Ù„Ø¨Ø´Ø±ÙŠØ©</option><option>Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª Ø§Ù„Ù…Ø§Ù„ÙŠØ©</option><option>Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª</option><option>Ø§Ù„Ø±Ù‚Ø§Ø¨Ø© ÙˆØ§Ù„Ø¬ÙˆØ¯Ø©</option></select></div></div><div class="m2"><div class="fg"><label>Ø§Ù„ÙˆØ¸ÙŠÙØ©</label><input class="fg-s" id="uJ"></div><div class="fg"><label>Ø§Ù„Ù‡Ø§ØªÙ</label><input class="fg-s" id="uPh"></div></div><button class="btn-sub" onclick="addUser()">Ø¥Ø¶Ø§ÙØ©</button>')}
async function addUser(){var n=$('uN').value.trim();var uu=$('uU').value.trim();var pp=$('uP').value;if(!n||!uu||!pp){toast('Ø£Ø¯Ø®Ù„ ÙƒÙ„ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©');return}if(users.find(function(x){return x.u===uu})){toast('Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù…ÙˆØ¬ÙˆØ¯');return}ld(true);closeMo();var res=await dbInsert('pms_users',{username:uu,password:pp,fullname:n,role:$('uR').value,email:$('uE').value,dept:$('uD').value,job_title:$('uJ').value,phone:$('uPh').value});if(res&&res[0])users.push({id:res[0].id,u:uu,p:pp,n:n,r:res[0].role,email:res[0].email,dept:res[0].dept,jobTitle:res[0].job_title,phone:res[0].phone});ld(false);render();toast('ØªÙ…Øª Ø§Ù„Ø¥Ø¶Ø§ÙØ© âœ…')}
async function delUser(id){var u=users.find(function(x){return x.id===id});if(!u||u.u==='admin'||!confirm('Ø­Ø°Ù '+u.n+'ØŸ'))return;ld(true);await dbDelete('pms_users',id);users=users.filter(function(x){return x.id!==id});ld(false);render();toast('ØªÙ… Ø§Ù„Ø­Ø°Ù')}
function editUser(id){var u=users.find(function(x){return x.id===id});if(!u)return;openMo('<h3>ØªØ¹Ø¯ÙŠÙ„ Ù…Ø³ØªØ®Ø¯Ù… <button onclick="closeMo()">âœ•</button></h3><div class="m2"><div class="fg"><label>Ø§Ù„Ø§Ø³Ù…</label><input class="fg-s" id="uN" value="'+u.n+'"></div><div class="fg"><label>Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</label><input class="fg-s" id="uU" value="'+u.u+'"></div></div><div class="m2"><div class="fg"><label>Ø§Ù„Ø¨Ø±ÙŠØ¯</label><input class="fg-s" id="uE" value="'+(u.email||'')+'"></div><div class="fg"><label>ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± (Ø§ØªØ±ÙƒÙ‡ ÙØ§Ø±Øº)</label><input class="fg-s" id="uP" type="password"></div></div><div class="m2"><div class="fg"><label>Ø§Ù„Ø¯ÙˆØ±</label><select class="fg-s" id="uR">'+[['super_admin','Ù…Ø¯ÙŠØ± Ø¹Ø§Ù…'],['project_manager','Ù…Ø¯ÙŠØ± Ù…Ø´Ø±ÙˆØ¹'],['team_lead','Ù‚Ø§Ø¦Ø¯ ÙØ±ÙŠÙ‚'],['employee','Ù…ÙˆØ¸Ù'],['viewer','Ù…Ø´Ø§Ù‡Ø¯']].map(function(r){return '<option value="'+r[0]+'"'+(r[0]===u.r?' selected':'')+'>'+r[1]+'</option>'}).join('')+'</select></div><div class="fg"><label>Ø§Ù„Ù‚Ø³Ù…</label><select class="fg-s" id="uD">'+['ØªÙ‚Ù†ÙŠØ© Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª','Ø§Ù„Ù…ÙˆØ§Ø±Ø¯ Ø§Ù„Ø¨Ø´Ø±ÙŠØ©','Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª Ø§Ù„Ù…Ø§Ù„ÙŠØ©','Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª','Ø§Ù„Ø±Ù‚Ø§Ø¨Ø© ÙˆØ§Ù„Ø¬ÙˆØ¯Ø©','Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¹Ø§Ù…Ø©'].map(function(d){return '<option'+(d===u.dept?' selected':'')+'>'+d+'</option>'}).join('')+'</select></div></div><div class="m2"><div class="fg"><label>Ø§Ù„ÙˆØ¸ÙŠÙØ©</label><input class="fg-s" id="uJ" value="'+(u.jobTitle||'')+'"></div><div class="fg"><label>Ø§Ù„Ù‡Ø§ØªÙ</label><input class="fg-s" id="uPh" value="'+(u.phone||'')+'"></div></div><button class="btn-sub" onclick="saveEditU('+id+')">Ø­ÙØ¸</button>')}
async function saveEditU(id){var n=$('uN').value.trim();if(!n)return;ld(true);closeMo();var upd={fullname:n,username:$('uU').value,email:$('uE').value,role:$('uR').value,dept:$('uD').value,job_title:$('uJ').value,phone:$('uPh').value};if($('uP').value)upd.password=$('uP').value;await dbUpdate('pms_users',id,upd);var u=users.find(function(x){return x.id===id});if(u){u.n=n;u.u=$('uU').value;u.email=$('uE').value;u.r=$('uR').value;u.dept=$('uD').value;u.jobTitle=$('uJ').value;u.phone=$('uPh').value;if($('uP').value)u.p=$('uP').value}ld(false);render();toast('ØªÙ… Ø§Ù„ØªØ­Ø¯ÙŠØ« âœ…')}

// === AI ANALYSIS ===
function showAI(type){openMo2('<h3>âœ¨ ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ <button onclick="closeMo2()">âœ•</button></h3><div style="text-align:center;padding:30px"><div class="spinner"></div><p style="color:var(--tx2);font-size:12px">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù„ÙŠÙ„...</p></div>');setTimeout(function(){var h='<h3>âœ¨ ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ <button onclick="closeMo2()">âœ•</button></h3>';var emps=getAllEmps();if(type==='dash'){var avgP=projects.length?(projects.reduce(function(s,p){return s+p.prog},0)/projects.length).toFixed(1):0;var hiRisk=projects.filter(function(p){return p.risk==='Ø¹Ø§Ù„ÙŠ'}).length;h+='<div class="ai-card"><h4>ğŸ“Š Ù…Ù„Ø®Øµ Ø§Ù„Ø£Ø¯Ø§Ø¡</h4><p>'+projects.length+' Ù…Ø´Ø§Ø±ÙŠØ¹ØŒ '+tasks.length+' Ù…Ù‡Ù…Ø©. Ù…ØªÙˆØ³Ø· Ø§Ù„ØªÙ‚Ø¯Ù… '+avgP+'%.</p></div><div class="ai-card"><h4>âš ï¸ ØªÙ†Ø¨ÙŠÙ‡Ø§Øª</h4><p>'+(hiRisk?hiRisk+' Ù…Ø´Ø§Ø±ÙŠØ¹ Ø¨Ù…Ø®Ø§Ø·Ø± Ø¹Ø§Ù„ÙŠØ©.':'Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø®Ø§Ø·Ø± Ø¹Ø§Ù„ÙŠØ©.')+' '+tasks.filter(function(t){return t.st==='pending'}).length+' Ù…Ù‡Ø§Ù… Ù…Ø¹Ù„Ù‚Ø©.</p></div><div class="ai-card"><h4>âœ… ØªÙˆØµÙŠØ§Øª</h4><p>'+(!projects.length?'Ø§Ø¨Ø¯Ø£ Ø¨Ø¥Ø¶Ø§ÙØ© Ù…Ø´Ø§Ø±ÙŠØ¹ ÙˆÙ…Ù‡Ø§Ù…':'1. Ù…ØªØ§Ø¨Ø¹Ø© Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹ Ø§Ù„Ù…ØªØ£Ø®Ø±Ø©<br>2. ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ù…Ù‡Ø§Ù… Ø¹Ù„Ù‰ Ø§Ù„Ù…ØªØ§Ø­ÙŠÙ†<br>3. Ù…Ø±Ø§Ø¬Ø¹Ø© Ø£Ø³Ø¨ÙˆØ¹ÙŠØ©')+'</p></div>'}else if(type==='hr'){var avail=emps.filter(function(e){return e.avail==='available'}).length;h+='<div class="ai-card"><h4>ğŸ“Š Ù…Ù„Ø®Øµ Ø§Ù„Ù…ÙˆØ§Ø±Ø¯</h4><p>'+emps.length+' Ù…ÙˆØ¸ÙÙŠÙ†. '+avail+' Ù…ØªØ§Ø­ÙˆÙ† Ùˆ'+(emps.length-avail)+' Ù…Ø´ØºÙˆÙ„ÙˆÙ†.</p></div><div class="ai-card"><h4>âœ… ØªÙˆØµÙŠØ§Øª</h4><p>'+(emps.length<3?'ÙØ±ÙŠÙ‚ ØµØºÙŠØ± - ÙŠÙÙ†ØµØ­ Ø¨ØªØ¹ÙŠÙŠÙ† Ø¥Ø¶Ø§ÙÙŠ.':'1. Ø§Ø³ØªØ«Ù…Ø§Ø± Ø§Ù„Ù…ØªØ§Ø­ÙŠÙ†<br>2. ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ø¹Ø¨Ø¡<br>3. Ø®Ø·Ø© ØªØ¯Ø±ÙŠØ¨')+'</p></div>'}else{var st={};evals.forEach(function(e){if(!st[e.emp])st[e.emp]={c:0,s:0};st[e.emp].c++;st[e.emp].s+=e.s+e.q+e.p});var b='',ba=0;Object.entries(st).forEach(function(x){var a=x[1].s/(x[1].c*3);if(a>ba){ba=a;b=x[0]}});h+=evals.length?'<div class="ai-card"><h4>ğŸ† Ø£ÙØ¶Ù„ Ø£Ø¯Ø§Ø¡</h4><p><b>'+b+'</b> Ø¨Ù…ØªÙˆØ³Ø· '+ba.toFixed(1)+'/10</p></div><div class="ai-card"><h4>ğŸ“ˆ ØªÙˆØµÙŠØ§Øª</h4><p>1. Ø±Ø¨Ø· Ø§Ù„ØªÙ‚ÙŠÙŠÙ…Ø§Øª Ø¨Ø§Ù„Ù…ÙƒØ§ÙØ¢Øª<br>2. Ù…Ø±Ø§Ø¬Ø¹Ø© Ø´Ù‡Ø±ÙŠØ©<br>3. ØªØ·ÙˆÙŠØ± Ù†Ù‚Ø§Ø· Ø§Ù„Ø¶Ø¹Ù</p></div>':'<div class="ai-card"><h4>Ù„Ø§ ØªÙˆØ¬Ø¯ ØªÙ‚ÙŠÙŠÙ…Ø§Øª</h4><p>Ø£Ø¶Ù ØªÙ‚ÙŠÙŠÙ…Ø§Øª Ø£ÙˆÙ„Ø§Ù‹.</p></div>'}$('MC2').innerHTML=h},1500)}
</script>
</body></html>
